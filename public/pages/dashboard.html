<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | Ù…Ù†ØµØ© Ø§Ù„ÙÙŠÙ„Ø³ÙˆÙ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</title>
    <meta name="description" content="Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯Ø±Ø³ - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ">
    <meta name="robots" content="noindex, nofollow">
    
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/pages_style/dashboard.css">
    <link rel="stylesheet" href="../assets/css/pages_style/students.css">
    <script type="importmap">
        {
            "imports": {
                "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
                "firebase/auth": "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js",
                "firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"
            }
        }
    </script>
    <style>
        #three-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }
        
        .waves {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 150px;
            z-index: 1;
            pointer-events: none;
        }

        .wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 200%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none"><path d="M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z" fill="%233b82f6" fill-opacity="0.05"/></svg>') repeat-x;
            animation: wave 15s linear infinite;
        }

        .wave:nth-child(2) {
            bottom: 10px;
            opacity: 0.5;
            animation: wave 20s linear infinite reverse;
        }

        @keyframes wave {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        
        .dashboard-layout,
        .dashboard-header,
        .dashboard-main {
            position: relative;
            z-index: 10;
        }

        .dashboard-layout {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 2rem;
            padding: 2rem;
            min-height: calc(100vh - 100px);
        }

        @media (max-width: 768px) {
            .dashboard-layout {
                grid-template-columns: 1fr;
            }
            
            .dashboard-sidebar {
                position: static;
                width: 100%;
            }
        }

        .dashboard-sidebar {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.7));
            backdrop-filter: blur(15px);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 20px;
            padding: 2rem;
            height: fit-content;
            position: sticky;
            top: 2rem;
        }

        .dashboard-main {
            background: rgba(15, 23, 42, 0.3);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(59, 130, 246, 0.2);
            border-radius: 20px;
            padding: 2rem;
        }

        .dashboard-title {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 2rem;
        }

        .dashboard-section {
            display: none;
        }

        .dashboard-section.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.8));
            backdrop-filter: blur(15px);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 20px;
            padding: 2rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            border-color: #3b82f6;
            box-shadow: 0 20px 60px rgba(59, 130, 246, 0.4);
        }

        .stat-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-icon {
            font-size: 3rem;
            opacity: 0.8;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: #94a3b8;
            margin-top: 0.5rem;
        }

        .sidebar-nav {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .sidebar-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 12px;
            color: #94a3b8;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .sidebar-link:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
            color: #f1f5f9;
            transform: translateX(-4px);
        }

        .sidebar-link.active {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2));
            border-color: #3b82f6;
            color: #f1f5f9;
        }

        .sidebar-icon {
            font-size: 1.5rem;
        }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 20px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: modalSlideIn 0.3s ease;
            max-height: 80vh;
            overflow-y: auto;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            color: #f1f5f9;
        }

        .modal-close {
            background: none;
            border: none;
            color: #94a3b8;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .modal-body {
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: #f1f5f9;
            font-weight: 500;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 1rem;
            background: rgba(15, 23, 42, 0.6);
            border: 2px solid rgba(59, 130, 246, 0.2);
            border-radius: 12px;
            color: #f1f5f9;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(15, 23, 42, 0.8);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .modal-footer {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
        }

        .btn-secondary {
            background: rgba(148, 163, 184, 0.2);
            color: #94a3b8;
            border: 1px solid rgba(148, 163, 184, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(148, 163, 184, 0.3);
            color: #f1f5f9;
        }

        .content-list {
            display: grid;
            gap: 1rem;
        }

        .content-item {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.7), rgba(15, 23, 42, 0.6));
            border: 2px solid rgba(59, 130, 246, 0.2);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .content-item:hover {
            border-color: #3b82f6;
            transform: translateX(-8px);
            box-shadow: 0 10px 40px rgba(59, 130, 246, 0.3);
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.85), rgba(15, 23, 42, 0.75));
        }

        .content-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .content-item-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #f1f5f9;
        }

        .content-item-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        .btn-danger {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .btn-danger:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        .tab-btn {
            padding: 0.75rem 1.5rem;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 12px;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .tab-btn:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: #3b82f6;
            color: #f1f5f9;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-color: #3b82f6;
            color: white;
        }

        .materials-content {
            display: none;
        }

        .materials-content.active {
            display: block;
        }
    </style>
</head>
<body class="dashboard-page">
    <canvas id="three-canvas"></canvas>
    <div class="waves">
        <div class="wave"></div>
        <div class="wave"></div>
    </div>
    <a href="#main-content" class="sr-only">ØªØ®Ø·Ù‰ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</a>
    <div id="navbar-placeholder"></div>

    <div class="dashboard-layout">
        <aside class="dashboard-sidebar" role="navigation" aria-label="Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©">
            <nav class="sidebar-nav">
                <a href="#overview" class="sidebar-link active" data-section="overview">
                    <span class="sidebar-icon" aria-hidden="true">ğŸ“Š</span>
                    <span>Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</span>
                </a>
                <a href="#videos" class="sidebar-link" data-section="videos">
                    <span class="sidebar-icon" aria-hidden="true">ğŸ¥</span>
                    <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</span>
                </a>
                <a href="#exams" class="sidebar-link" data-section="exams">
                    <span class="sidebar-icon" aria-hidden="true">ğŸ“‹</span>
                    <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</span>
                </a>
                <a href="#notes" class="sidebar-link" data-section="notes">
                    <span class="sidebar-icon" aria-hidden="true">ğŸ“</span>
                    <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</span>
                </a>
                <a href="#materials" class="sidebar-link" data-section="materials">
                    <span class="sidebar-icon" aria-hidden="true">ğŸ“š</span>
                    <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø°ÙƒØ±Ø§Øª</span>
                </a>
                <a href="#testimonials" class="sidebar-link" data-section="testimonials">
                    <span class="sidebar-icon" aria-hidden="true">ğŸ’¬</span>
                    <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¢Ø±Ø§Ø¡</span>
                </a>
                <a href="#students" class="sidebar-link" data-section="students">
                    <span class="sidebar-icon" aria-hidden="true">ğŸ‘¥</span>
                    <span>Ø§Ù„Ø·Ù„Ø§Ø¨</span>
                </a>
            </nav>
        </aside>

        <main id="main-content" class="dashboard-main" role="main">
            <section id="overview-section" class="dashboard-section active">
                <h1 class="dashboard-title fade-in">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</h1>
                
                <div class="stats-grid slide-in" role="list">
                    <article class="stat-card hover-lift" role="listitem">
                        <div class="stat-icon" aria-hidden="true">ğŸ¥</div>
                        <div class="stat-content">
                            <div class="stat-value" id="totalVideos">0</div>
                            <div class="stat-label">ÙÙŠØ¯ÙŠÙˆ</div>
                        </div>
                    </article>
                    
                    <article class="stat-card hover-lift" role="listitem">
                        <div class="stat-icon" aria-hidden="true">ğŸ“‹</div>
                        <div class="stat-content">
                            <div class="stat-value" id="totalExams">0</div>
                            <div class="stat-label">Ø§Ù…ØªØ­Ø§Ù†</div>
                        </div>
                    </article>
                    
                    <article class="stat-card hover-lift" role="listitem">
                        <div class="stat-icon" aria-hidden="true">ğŸ‘¥</div>
                        <div class="stat-content">
                            <div class="stat-value" id="totalStudents">0</div>
                            <div class="stat-label">Ø·Ø§Ù„Ø¨</div>
                        </div>
                    </article>
                    
                    <article class="stat-card hover-lift" role="listitem">
                        <div class="stat-icon" aria-hidden="true">ğŸ“</div>
                        <div class="stat-content">
                            <div class="stat-value" id="totalNotes">0</div>
                            <div class="stat-label">Ù…Ù„Ø§Ø­Ø¸Ø©</div>
                        </div>
                    </article>
                </div>

                <div class="recent-activity">
                    <h2>Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø£Ø®ÙŠØ±</h2>
                    <div id="recent-activity-list"></div>
                </div>
            </section>

            <section id="videos-section" class="dashboard-section">
                <div class="section-header">
                    <h1 class="dashboard-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</h1>
                    <button class="btn btn-primary" id="addVideoBtn">
                        <span aria-hidden="true">â•</span> Ø¥Ø¶Ø§ÙØ© ÙÙŠØ¯ÙŠÙˆ
                    </button>
                </div>
                
                <div id="videosList" class="content-list"></div>
            </section>

            <section id="exams-section" class="dashboard-section">
                <div class="section-header">
                    <h1 class="dashboard-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</h1>
                    <button class="btn btn-primary" id="addExamBtn">
                        <span aria-hidden="true">â•</span> Ø¥Ø¶Ø§ÙØ© Ø§Ù…ØªØ­Ø§Ù†
                    </button>
                </div>
                
                <div id="examsList" class="content-list"></div>
            </section>

            <section id="notes-section" class="dashboard-section">
                <div class="section-header">
                    <h1 class="dashboard-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h1>
                    <button class="btn btn-primary" id="addNoteBtn">
                        <span aria-hidden="true">â•</span> Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø©
                    </button>
                </div>
                
                <div id="notesList" class="content-list"></div>
            </section>

            <section id="materials-section" class="dashboard-section">
                <div class="section-header">
                    <h1 class="dashboard-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø°ÙƒØ±Ø§Øª ÙˆØ§Ù„Ù…Ù„Ø§Ø²Ù…</h1>
                    <button class="btn btn-primary" id="addMaterialBtn">
                        <span aria-hidden="true">â•</span> Ø¥Ø¶Ø§ÙØ© Ù…Ø°ÙƒØ±Ø©
                    </button>
                </div>
                
                <div class="materials-tabs" style="display: flex; gap: 1rem; margin-bottom: 2rem;">
                    <button class="tab-btn active" data-grade="1">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„</button>
                    <button class="tab-btn" data-grade="2">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ</button>
                    <button class="tab-btn" data-grade="3">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«</button>
                </div>
                
                <div id="materialsGrade1" class="materials-content active"></div>
                <div id="materialsGrade2" class="materials-content" style="display: none;"></div>
                <div id="materialsGrade3" class="materials-content" style="display: none;"></div>
            </section>

            <section id="testimonials-section" class="dashboard-section">
                <div class="section-header">
                    <h1 class="dashboard-title">Ø¥Ø¯Ø§Ø±Ø© Ø¢Ø±Ø§Ø¡ Ø§Ù„Ø·Ù„Ø§Ø¨</h1>
                    <button class="btn btn-primary" id="addTestimonialBtn">
                        <span aria-hidden="true">â•</span> Ø¥Ø¶Ø§ÙØ© Ø±Ø£ÙŠ
                    </button>
                </div>
                
                <div id="testimonialsList" class="content-list"></div>
            </section>

            <section id="students-section" class="dashboard-section">
                <h1 class="dashboard-title">Ø§Ù„Ø·Ù„Ø§Ø¨</h1>
                <div id="studentsList" class="students-grid"></div>
            </section>
        </main>
    </div>

    <div id="footer-placeholder"></div>

    <!-- Student Detail Modal -->
    <div id="studentModal" class="modal" aria-hidden="true">
      <div class="modal-backdrop" onclick="document.getElementById('studentModal').classList.remove('open')"></div>
      <div class="modal-dialog">
        <button class="modal-close" onclick="document.getElementById('studentModal').classList.remove('open')">Ã—</button>
        <h3 id="modalStudentName">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
        <div class="student-info">
          <div><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯:</strong> <span id="modalStudentEmail"></span></div>
          <div><strong>Ø§Ù†Ø¶Ù…:</strong> <span id="modalStudentJoined"></span></div>
          <div id="modalStudentDetails"></div>
        </div>
      </div>
    </div>

    <script src="../assets/dist/components-loader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // ğŸ” Authenticationop
        function checkDashboardAuth() {
            console.log('Checking dashboard authentication...');
            
            // Check if user is logged in
            const currentUserEmail = localStorage.getItem('currentUserEmail');
            const userRole = localStorage.getItem('userRole');
            const currentUser = localStorage.getItem('currentUser');
            
            console.log('Auth data:', { currentUserEmail, userRole, currentUser: !!currentUser });
            
            // If no user data, redirect to login
            if (!currentUserEmail || !currentUser) {
                console.log('No user data found, redirecting to login');
                showToast('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…', 'warning');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 2000);
                return false;
            }
            
            // Check if user is teacher
            if (userRole !== 'teacher') {
                console.log('User is not a teacher, redirecting to profile');
                showToast('Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù…Ø®ØµØµØ© Ù„Ù„Ù…Ø¯Ø±Ø³ÙŠÙ† ÙÙ‚Ø·', 'error');
                setTimeout(() => {
                    window.location.href = 'profile.html';
                }, 2000);
                return false;
            }
            
            // Special check for teacher credentials
            try {
                const userData = JSON.parse(currentUser);
                const isValidTeacher = (
                    currentUserEmail === 'mohamednaser@gmail.com' ||
                    userRole === 'teacher'
                );
                
                if (!isValidTeacher) {
                    console.log('âŒ Invalid teacher credentials');
                    showToast('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…Ø¯Ø±Ø³ ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 2000);
                    return false;
                }
                
                console.log('Teacher authentication successful');
                showToast('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø£Ø³ØªØ§Ø° ' + (userData.name || 'Ù…Ø­Ù…Ø¯'), 'success');
                return true;
                
            } catch (error) {
                console.error('Error parsing user data:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 2000);
                return false;
            }
      }
        
        // Run authentication check immediately
        if (!checkDashboardAuth()) {
            // Stop further script execution if auth fails
            throw new Error('Authentication failed');
        }
        
        // Toast notification system
        function showToast(message, type = 'info', duration = 3000) {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            const icon = {
                success: 'âœ…',
                error: 'âŒ',
                warning: 'âš ï¸',
                info: 'â„¹ï¸'
            }[type];
            
            toast.innerHTML = `
                <div class="toast-content">
                    <span class="toast-icon">${icon}</span>
                    <span class="toast-message">${message}</span>
                    <button class="toast-close" onclick="this.parentElement.parentElement.remove()">Ã—</button>
                </div>
            `;
            
            // Add toast styles if not already added
            if (!document.getElementById('toast-styles')) {
                const styles = document.createElement('style');
                styles.id = 'toast-styles';
                styles.textContent = `
                    .toast {
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: rgba(30, 41, 59, 0.95);
                        backdrop-filter: blur(10px);
                        border-radius: 12px;
                        padding: 1rem;
                        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                        z-index: 10000;
                        animation: slideInRight 0.3s ease;
                        max-width: 400px;
                        border-left: 4px solid;
                    }
                    
                    .toast-success { border-left-color: #10b981; }
                    .toast-error { border-left-color: #ef4444; }
                    .toast-warning { border-left-color: #f59e0b; }
                    .toast-info { border-left-color: #3b82f6; }
                    
                    .toast-content {
                        display: flex;
                        align-items: center;
                        gap: 0.75rem;
                        color: #f1f5f9;
                    }
                    
                    .toast-icon {
                        font-size: 1.2rem;
                        flex-shrink: 0;
                    }
                    
                 .toast-message {
                        flex: 1;
                        font-size: 0.95rem;
                    }
                    
                    .toast-close {
                        background: none;
                        border: none;
                        color: #94a3b8;
                        font-size: 1.2rem;
                        cursor: pointer;
                        padding: 0;
                        width: 24px;
                        height: 24px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border-radius: 50%;
                        transition: all 0.3s ease;
                    }
                    
                    .toast-close:hover {
                        background: rgba(148, 163, 184, 0.2);
                        color: #f1f5f9;
                    }
                    
                    @keyframes slideInRight {
                        from {
                            opacity: 0;
                            transform: translateX(100%);
                        }
                        to {
                            opacity: 1;
                            transform: translateX(0);
                        }
                    }
                `;
                document.head.appendChild(styles);
            }
            
            document.body.appendChild(toast);
            
            // Auto remove after duration
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.style.animation = 'slideInRight 0.3s ease reverse';
                    setTimeout(() => toast.remove(), 300);
                }
            }, duration);
        }

        // Three.js Scene - Philosophy Brain Model
        const canvas = document.getElementById('three-canvas');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });

        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        camera.position.z = 5;

        // Create Brain
        const brainGeometry = new THREE.IcosahedronGeometry(0.8, 1);
        const brainMaterial = new THREE.MeshNormalMaterial({ wireframe: true, opacity: 0.3, transparent: true });
        const brain = new THREE.Mesh(brainGeometry, brainMaterial);
        scene.add(brain);

        // Create Logic Symbols
        const symbolGeometry = new THREE.OctahedronGeometry(0.25);
        const symbolMaterial = new THREE.MeshNormalMaterial({ wireframe: false, opacity: 0.4, transparent: true });
        
        const symbols = [];
        for (let i = 0; i < 6; i++) {
            const symbol = new THREE.Mesh(symbolGeometry, symbolMaterial);
            const angle = (i / 6) * Math.PI * 2;
            symbol.position.x = Math.cos(angle) * 2;
            symbol.position.y = Math.sin(angle) * 2;
            symbols.push(symbol);
            scene.add(symbol);
        }

        // Create Particles
        const particlesGeometry = new THREE.BufferGeometry();
        const particlesCount = 500;
        const posArray = new Float32Array(particlesCount * 3);

        for (let i = 0; i < particlesCount * 3; i++) {
            posArray[i] = (Math.random() - 0.5) * 10;
        }

        particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        const particlesMaterial = new THREE.PointsMaterial({ size: 0.02, color: 0x3b82f6, opacity: 0.6, transparent: true });
        const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
        scene.add(particlesMesh);

        // Animation
        let time = 0;
        function animate() {
            requestAnimationFrame(animate);
            time += 0.01;
            
            brain.rotation.x += 0.005;
            brain.rotation.y += 0.005;
            
            symbols.forEach((symbol, i) => {
                const angle = (i / 6) * Math.PI * 2 + time * 0.3;
                symbol.position.x = Math.cos(angle) * 2;
                symbol.position.y = Math.sin(angle) * 2;
                symbol.rotation.x += 0.02;
                symbol.rotation.y += 0.02;
            });
            
            particlesMesh.rotation.y += 0.0005;
            renderer.render(scene, camera);
        }

        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Dashboard Functionality
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Dashboard loaded successfully!');
            
            // Load Data from LocalStorage
            let videos = JSON.parse(localStorage.getItem('videos') || '[]');
            let exams = JSON.parse(localStorage.getItem('exams') || '[]');
            let notes = JSON.parse(localStorage.getItem('notes') || '[]');
            let testimonials = JSON.parse(localStorage.getItem('testimonials') || '[]');
            let materials = JSON.parse(localStorage.getItem('materials') || '[]');
            
            console.log('Loaded data:', {
                videos: videos.length,
                exams: exams.length,
                notes: notes.length,
                
                materials: materials.length
            });
            
            // Save to LocalStorage
            function saveData() {
                try {
                    console.log('Saving data...');
                    localStorage.setItem('videos', JSON.stringify(videos));
                    localStorage.setItem('exams', JSON.stringify(exams));
                    localStorage.setItem('notes', JSON.stringify(notes));
                    localStorage.setItem('testimonials', JSON.stringify(testimonials));
                    localStorage.setItem('materials', JSON.stringify(materials));
                    console.log('Data saved successfully!');
                    return true;
                } catch (error) {
                    console.error('Error saving data:', error);
                    showToast('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message, 'error');
                    return false;
                }
            }

            // Modal Functions
            function createModal(title, content, onSubmit) {
                console.log('ğŸ”„ Creating modal:', title);

                const modal = document.createElement('div');
                modal.className = 'modal-overlay active';
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2 class="modal-title">${title}</h2>
                            <button class="modal-close" aria-label="Ø¥ØºÙ„Ø§Ù‚">âœ•</button>
                        </div>
                        <div class="modal-body">
                            ${content}
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary modal-cancel">Ø¥Ù„ØºØ§Ø¡</button>
                            <button class="btn btn-primary modal-submit">Ø­ÙØ¸</button>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);

                const closeBtn = modal.querySelector('.modal-close');
                const cancelBtn = modal.querySelector('.modal-cancel');
                const submitBtn = modal.querySelector('.modal-submit');

                function closeModal() {
                    console.log('ğŸ”„ Closing modal');
                    modal.classList.remove('active');
                    setTimeout(() => modal.remove(), 300);
                }

                closeBtn.addEventListener('click', closeModal);
                cancelBtn.addEventListener('click', closeModal);
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) closeModal();
                });

                submitBtn.addEventListener('click', () => {
                    console.log('Modal submit clicked');
                    submitBtn.disabled = true;
                    submitBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';

                    try {
                        const result = onSubmit(closeModal);

                        if (result && typeof result.then === 'function') {
                            result.then((success) => {
                                if (success !== false) {
                                    closeModal();
                                } else {
                                    submitBtn.disabled = false;
                                    submitBtn.textContent = 'Ø­ÙØ¸';
                                }
                            }).catch(() => {
                                submitBtn.disabled = false;
                                submitBtn.textContent = 'Ø­ÙØ¸';
                            });
                        } else if (result !== false) {
                            closeModal();
                        } else {
                            submitBtn.disabled = false;
                            submitBtn.textContent = 'Ø­ÙØ¸';
                        }
                    } catch (error) {
                        console.error('Error in modal submit:', error);
                        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error.message, 'error');
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'Ø­ÙØ¸';
                    }
                });

                return modal;
            }

            function createConfirmModal(title, message, onConfirm) {
                const modal = document.createElement('div');
                modal.className = 'modal-overlay active';
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2 class="modal-title">${title}</h2>
                            <button class="modal-close" aria-label="Ø¥ØºÙ„Ø§Ù‚">âœ•</button>
                        </div>
                        <div class="modal-body">
                            <p style="color: #f1f5f9; font-size: 1.1rem;">${message}</p>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary modal-cancel">Ø¥Ù„ØºØ§Ø¡</button>
                            <button class="btn btn-danger modal-confirm">ØªØ£ÙƒÙŠØ¯</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                const closeBtn = modal.querySelector('.modal-close');
                const cancelBtn = modal.querySelector('.modal-cancel');
                const confirmBtn = modal.querySelector('.modal-confirm');
                
                function closeModal() {
                    modal.classList.remove('active');
                    setTimeout(() => modal.remove(), 300);
                }
                
                closeBtn.addEventListener('click', closeModal);
                cancelBtn.addEventListener('click', closeModal);
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) closeModal();
                });
                
                confirmBtn.addEventListener('click', () => {
                    onConfirm();
                    closeModal();
                });
            }

            // Sidebar Navigation
            const sidebarLinks = document.querySelectorAll('.sidebar-link');
            const sections = document.querySelectorAll('.dashboard-section');
            
            sidebarLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const sectionId = link.getAttribute('data-section');
                    
                    console.log('Switching to section:', sectionId);
                    
                    sidebarLinks.forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                    
                    sections.forEach(s => s.classList.remove('active'));
                    const targetSection = document.getElementById(`${sectionId}-section`);
                    if (targetSection) {
                        targetSection.classList.add('active');
                    }
                });
            });

            // Add Testimonial Button
            const addTestimonialBtn = document.getElementById('addTestimonialBtn');
            if (addTestimonialBtn) {
                console.log('Add Testimonial Button found');
                addTestimonialBtn.addEventListener('click', function() {
                    console.log('Add Testimonial button clicked');
                    createModal(
                        'Ø¥Ø¶Ø§ÙØ© Ø±Ø£ÙŠ Ø·Ø§Ù„Ø¨',
                        `
                        <form id="testimonialForm">
                            <div class="form-group">
                                <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</label>
                                <input type="text" class="form-input" id="studentName" required>
                            </div>
                            <div class="form-group">
                         <label class="form-label">Ø§Ù„Ø±Ø£ÙŠ</label>
                                <textarea class="form-textarea" id="testimonialComment" rows="4" required></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</label>
                                <select class="form-select" id="testimonialRating" required>
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</option>
                                    <option value="5">â­â­â­â­â­ (5/5)</option>
                                    <option value="4">â­â­â­â­ (4/5)</option>
                                    <option value="3">â­â­â­ (3/5)</option>
                                    <option value="2">â­â­ (2/5)</option>
                                    <option value="1">â­ (1/5)</option>
                                </select>
                            </div>
                        </form>
                        `,
                        () => {
                            console.log('Processing testimonial form...');
                            const studentName = document.getElementById('studentName').value.trim();
                            const comment = document.getElementById('testimonialComment').value.trim();
                            const rating = document.getElementById('testimonialRating').value;
                            
                            console.log('ğŸ“‹ Form data:', { studentName, comment, rating });
                            
                            if (!studentName || !comment || !rating) {
                                showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                                return false;
                            }
                            
                            const newTestimonial = {
                                id: Date.now(),
                                studentName,
                                comment,
                                rating: parseInt(rating),
                                createdAt: new Date().toISOString()
                            };
                            
                            console.log('Adding testimonial:', newTestimonial);
                            testimonials.push(newTestimonial);
                            
                            if (saveData()) {
                                renderTestimonials();
                                showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø±Ø£ÙŠ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                                console.log('Testimonial added successfully');
                                return true;
                            } else {
                                console.error('Failed to save testimonial');
                                return false;
                            }
                        }
                    );
                });
            } else {
                console.error('Add Testimonial Button not found!');
            }

            // Add Note Button
            const addNoteBtn = document.getElementById('addNoteBtn');
            if (addNoteBtn) {
                console.log('Add Note Button found');
                addNoteBtn.addEventListener('click', function() {
                    console.log('Add Note button clicked');
                    createModal(
                        'Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©',
                        `
                        <form id="noteForm">
                            <div class="form-group">
                                <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</label>
                                <input type="text" class="form-input" id="noteTitle" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§Ù„Ù…Ø­ØªÙˆÙ‰</label>
                                <textarea class="form-textarea" id="noteContent" rows="6" required></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§Ù„ÙØ¦Ø©</label>
                                <select class="form-select" id="noteCategory">
                                    <option value="general">Ø¹Ø§Ù…</option>
                                    <option value="important">Ù…Ù‡Ù…</option>
                                    <option value="exam">Ù…ØªØ¹Ù„Ù‚ Ø¨Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</option>
                                </select>
                            </div>
                        </form>
                        `,
                        () => {
                            console.log('Processing note form...');
                            const title = document.getElementById('noteTitle').value.trim();
                            const content = document.getElementById('noteContent').value.trim();
                            const category = document.getElementById('noteCategory').value;
                            
                            console.log('ğŸ“‹ Form data:', { title, content, category });
                            
                            if (!title || !content) {
                                showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                                return false;
                            }
                            
                            const newNote = {
                                id: Date.now(),
                                title,
                                content,
                                category,
                                createdAt: new Date().toISOString()
                            };
                            
                            console.log('Adding note:', newNote);
                            notes.push(newNote);
                            
                            if (saveData()) {
                                renderNotes();
                                updateStats();
                                showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                                console.log('Note added successfully');
                                return true;
                            } else {
                                console.error('Failed to save note');
                                return false;
                            }
                        }
                    );
                });
            } else {
                console.error('Add Note Button not found!');
            }

            // Add Material Button
            const addMaterialBtn = document.getElementById('addMaterialBtn');
            if (addMaterialBtn) {
                console.log('Add Material Button found');
                addMaterialBtn.addEventListener('click', function() {
                    console.log('Add Material button clicked');
                    createModal(
                        'Ø¥Ø¶Ø§ÙØ© Ù…Ø°ÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©',
                        `
                        <form id="materialForm">
                            <div class="form-group">
                                <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø°ÙƒØ±Ø©</label>
                                <input type="text" class="form-input" id="materialTitle" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label>
                                <select class="form-select" id="materialGrade" required>
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>
                                    <option value="1">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                           <option value="2">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                                    <option value="3">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„Ù…Ø°ÙƒØ±Ø© (PDF)</label>
                                <input type="file" class="form-input" id="materialFile" accept=".pdf" required>
                                <p style="color: #94a3b8; font-size: 0.875rem; margin-top: 0.5rem;">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: 10 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª</p>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§Ù„ÙˆØµÙ</label>
                                <textarea class="form-textarea" id="materialDescription"></textarea>
                            </div>
                        </form>
                        `,
                        (closeModal) => {
                            console.log('Processing material form...');
                            const title = document.getElementById('materialTitle').value.trim();
                            const grade = document.getElementById('materialGrade').value;
                            const description = document.getElementById('materialDescription').value.trim();
                            const fileInput = document.getElementById('materialFile');
                            
                            console.log('ğŸ“‹ Form data:', { title, grade, description, hasFile: !!fileInput.files[0] });
                            
                            if (!title || !grade || !fileInput.files || !fileInput.files[0]) {
                                showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                                return false;
                            }
                            
                            const file = fileInput.files[0];
                            if (file.size > 10 * 1024 * 1024) {
                                showToast('Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 10 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª)', 'error');
                                return false;
                            }
                            
                            return new Promise((resolve) => {
                                console.log('Reading file...');
                                const reader = new FileReader();
                                reader.onload = function(e) {
                                    const newMaterial = {
                                        id: Date.now(),
                                        title,
                                        grade,
                                        description,
                                        fileUrl: e.target.result,
                                        fileName: file.name,
                                        fileSize: (file.size / (1024 * 1024)).toFixed(2) + ' MB',
                                        createdAt: new Date().toISOString()
                                    };
                                    
                                    console.log('Adding material:', { ...newMaterial, fileUrl: '[DATA]' });
                                    materials.push(newMaterial);
                                    
                                    if (saveData()) {
                                        renderMaterials();
                                        showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø°ÙƒØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                                        console.log('Material added successfully');
                                        resolve(true);
                                    } else {
                                        console.error('Failed to save material');
                                        resolve(false);
                                    }
                                };
                                reader.onerror = function() {
                                    console.error('Error reading file');
                                    showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù', 'error');
                                    resolve(false);
                                };
                                reader.readAsDataURL(file);
                            });
                        }
                    );
                });
            } else {
                console.error('Add Material Button not found!');
            }

            // Materials Tabs
            const materialsTabs = document.querySelectorAll('.tab-btn');
            materialsTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    materialsTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    const grade = this.getAttribute('data-grade');
                    document.querySelectorAll('.materials-content').forEach(content => {
                        content.classList.remove('active');
                        content.style.display = 'none';
                    });
                    const targetContent = document.getElementById(`materialsGrade${grade}`);
                    if (targetContent) {
                        targetContent.classList.add('active');
                        targetContent.style.display = 'block';
                    }
                });
            });

            // Render Functions
            function renderTestimonials() {
                console.log('Rendering testimonials...');
                const testimonialsList = document.getElementById('testimonialsList');
                if (!testimonialsList) {
                    console.error('Testimonials list element not found!');
                    return;
                }
                
                if (testimonials.length === 0) {
                    testimonialsList.innerHTML = '<p style="text-align: center; color: #94a3b8; padding: 2rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¢Ø±Ø§Ø¡ Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
                    return;
                }
                
                testimonialsList.innerHTML = testimonials.map(testimonial => `
                    <div class="content-item">
                        <div class="content-item-header">
                            <h3 class="content-item-title">${testimonial.studentName}</h3>
                            <div class="content-item-actions">
                                <button class="btn btn-sm btn-danger" onclick="deleteTestimonial(${testimonial.id})">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                            </div>
                        </div>
                        <p style="color: #94a3b8; margin-top: 0.5rem;">${testimonial.comment}</p>
                        <p style="color: #fbbf24; font-size: 1.2rem; margin-top: 0.5rem;">${'â­'.repeat(testimonial.rating)}</p>
                    </div>
                `).join('');
                
                console.log('Testimonials rendered:', testimonials.length);
            }

            function renderNotes() {
                console.log('Rendering notes...');
                const notesList = document.getElementById('notesList');
                if (!notesList) {
                    console.error('Notes list element not found!');
                    return;
                }
                
                if (notes.length === 0) {
                    notesList.innerHTML = '<p style="text-align: center; color: #94a3b8; padding: 2rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
                    return;
                }
                
                const categoryLabels = {
                 'general': 'Ø¹Ø§Ù…',
                    'important': 'Ù…Ù‡Ù…',
                    'exam': 'Ù…ØªØ¹Ù„Ù‚ Ø¨Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†'
                };
                
                notesList.innerHTML = notes.map(note => `
                    <div class="content-item">
                        <div class="content-item-header">
                            <h3 class="content-item-title">${note.title}</h3>
                            <div class="content-item-actions">
                                <button class="btn btn-sm btn-danger" onclick="deleteNote(${note.id})">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                            </div>
                        </div>
                        <p style="color: #94a3b8; margin-top: 0.5rem;">${note.content}</p>
                        <p style="color: #64748b; font-size: 0.875rem; margin-top: 0.5rem;">Ø§Ù„ÙØ¦Ø©: ${categoryLabels[note.category]}</p>
                    </div>
                `).join('');
                
                console.log('Notes rendered:', notes.length);
            }

            function renderMaterials() {
                console.log('Rendering materials...');
                const gradeLabels = {
                    '1': 'Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ',
                    '2': 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ',
                    '3': 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ'
                };
                
                ['1', '2', '3'].forEach(grade => {
                    const container = document.getElementById(`materialsGrade${grade}`);
                    if (!container) {
                        console.error(`Materials container for grade ${grade} not found!`);
                        return;
                    }
                    
                    const gradeMaterials = materials.filter(m => m.grade === grade);
                    
                    if (gradeMaterials.length === 0) {
                        container.innerHTML = `<p style="text-align: center; color: #94a3b8; padding: 2rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø°ÙƒØ±Ø§Øª Ù„Ù€ ${gradeLabels[grade]}</p>`;
                        return;
                    }
                    
                    container.innerHTML = gradeMaterials.map(material => `
                        <div class="content-item">
                            <div class="content-item-header">
                                <h3 class="content-item-title">ğŸ“š ${material.title}</h3>
                                <div class="content-item-actions">
                                    <button class="btn btn-sm btn-primary" onclick="window.open('${material.fileUrl}', '_blank')">ğŸ“„ Ø¹Ø±Ø¶</button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteMaterial(${material.id})">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                                </div>
                            </div>
                            <p style="color: #94a3b8; margin-top: 0.5rem;">${material.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}</p>
                            <p style="color: #64748b; font-size: 0.875rem; margin-top: 0.5rem;">
                                Ø§Ù„ØµÙ: ${gradeLabels[material.grade]} | Ø§Ù„Ø­Ø¬Ù…: ${material.fileSize}
                            </p>
                        </div>
                    `).join('');
                });
                
                console.log('Materials rendered for all grades');
            }

            function updateStats() {
                console.log('Updating stats...');
                document.getElementById('totalVideos').textContent = videos.length;
                document.getElementById('totalExams').textContent = exams.length;
                document.getElementById('totalNotes').textContent = notes.length;
                document.getElementById('totalStudents').textContent = '0'; // ÙŠÙ…ÙƒÙ† ØªØ­Ø¯ÙŠØ«Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹
                console.log('Stats updated');
            }

            // Delete Functions
            window.deleteTestimonial = function(id) {
                console.log('Deleting testimonial:', id);
                createConfirmModal(
                    'Ø­Ø°Ù Ø§Ù„Ø±Ø£ÙŠ',
                    'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø±Ø£ÙŠØŸ',
                    () => {
                        testimonials = testimonials.filter(t => t.id !== id);
                        saveData();
                        renderTestimonials();
                        showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø±Ø£ÙŠ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                        console.log('Testimonial deleted');
                    }
                );
            };

            window.deleteNote = function(id) {
                console.log('Deleting note:', id);
                createConfirmModal(
                    'Ø­Ø°Ù Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©',
                    'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©ØŸ',
                    () => {
                        notes = notes.filter(n => n.id !== id);
                        saveData();
                        renderNotes();
                        updateStats();
                        showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                        console.log('Note deleted');
                    }
                );
            };

            window.deleteMaterial = function(id) {
                console.log('Deleting material:', id);
                createConfirmModal(
                    'Ø­Ø°Ù Ø§Ù„Ù…Ø°ÙƒØ±Ø©',
                    'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø°ÙƒØ±Ø©ØŸ',
                    () => {
                        materials = materials.filter(m => m.id !== id);
                        saveData();
                        renderMaterials();
                        showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø°ÙƒØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                        console.log('Material deleted');
                    }
                );
            };

            // Initial render
            console.log('Initial rendering...');
            renderTestimonials();
            renderNotes();
            renderMaterials();
            updateStats();
            
            // Test buttons after a short delay
            setTimeout(() => {
                const testimonialBtn = document.getElementById('addTestimonialBtn');
                const noteBtn = document.getElementById('addNoteBtn');
                const materialBtn = document.getElementById('addMaterialBtn');
                
                console.log('Button status check:', {
                    testimonialBtn: !!testimonialBtn,
                    noteBtn: !!noteBtn,
                    materialBtn: !!materialBtn
                });
                
                if (!testimonialBtn) console.error('Testimonial button missing!');
                if (!noteBtn) console.error('Note button missing!');
                if (!materialBtn) console.error('Material button missing!');
            }, 1000);
            
            console.log('Dashboard initialization complete!');
        });
    </script>

    <script type="module">
        import { initializeApp } from 'firebase/app';
        import { getFirestore, collection, getDocs, query, where } from 'firebase/firestore';
        import { firebaseConfig } from '../assets/dist/firebase-config.js';

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function loadAllStudents() {
            const container = document.getElementById('studentsList');
            if (!container) return;

            container.innerHTML = '<div class="loading"><div class="spinner"></div><span>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨...</span></div>';

            try {
                const snapshot = await getDocs(query(collection(db, 'users'), where('role', '==', 'student')));

                const totalStudentsEl = document.getElementById('totalStudents');
                if (totalStudentsEl) totalStudentsEl.textContent = snapshot.size.toString();

                if (snapshot.empty) {
                    container.innerHTML = '<div class="empty-state"><p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨</p></div>';
                    return;
                }

                container.innerHTML = '';
                snapshot.forEach((docSnap) => {
                    const student = docSnap.data();
                    const card = document.createElement('div');
                    card.className = 'student-card';
                    card.setAttribute('data-uid', docSnap.id);
                    card.innerHTML = `
                        <div class="student-avatar">${(student.name||student.email||'Ø·Ø§Ù„Ø¨').split(' ').map(w=>w.charAt(0)).join('').toUpperCase().slice(0,2)}</div>
                        <div class="student-body">
                          <h4 class="student-name">${student.name || 'Ø·Ø§Ù„Ø¨'}</h4>
                          <div class="student-email">${student.email || ''}</div>
                        </div>
                        <div class="student-meta">Ø§Ù†Ø¶Ù…: ${student.createdAt ? new Date(student.createdAt).toLocaleDateString('ar-EG') : '-'}</div>
                    `;
                    container.appendChild(card);
                });

                // delegation for student click -> open modal
                container.addEventListener('click', async function(ev){
                    const target = ev.target;
                    const card = target.closest && target.closest('.student-card');
                    if (!card) return;
                    const uid = card.getAttribute('data-uid');
                    if (!uid) return;

                    try{
                        const d = await getDocs(query(collection(db,'users'), where('__name__','==', uid)));
                        let studentData = null;
                        if (!d.empty) studentData = d.docs[0].data();
                        // populate modal
                        const modal = document.getElementById('studentModal');
                        if (!modal) return;
                        (document.getElementById('modalStudentName')).textContent = (studentData && studentData.name) || student.name || 'Ø·Ø§Ù„Ø¨';
                        (document.getElementById('modalStudentEmail')).textContent = (studentData && studentData.email) || student.email || '';
                        (document.getElementById('modalStudentJoined')).textContent = (studentData && studentData.createdAt) ? new Date(studentData.createdAt).toLocaleString('ar-EG') : (student.createdAt ? new Date(student.createdAt).toLocaleString('ar-EG') : '-');
                        (document.getElementById('modalStudentDetails')).textContent = (studentData && (studentData.bio || studentData.note)) || '';
                        modal.classList.add('open');
                    }catch(err){console.error(err);}
                });
            } catch (error) {
                console.error('Error loading students:', error);
                container.innerHTML = '<div class="error-state"><p>Ø­Ø¯Ø« Ø®Ø·Ø£</p></div>';
            }
        }

        document.addEventListener('DOMContentLoaded', loadAllStudents);
    </script>
</body>
</html>