<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | Ù…Ù†ØµØ© Ù…Ø­Ù…Ø¯ Ù†Ø§ØµØ± Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</title>
    <meta name="description" content="Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯Ø±Ø³ - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ">
    <meta name="robots" content="noindex, nofollow">
    
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/pages_style/dashboard.css">
    <link rel="stylesheet" href="../assets/css/responsive.css">
    <style>
        #three-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }
        
        .waves {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 150px;
            z-index: 1;
            pointer-events: none;
        }

        .wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 200%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none"><path d="M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z" fill="%233b82f6" fill-opacity="0.05"/></svg>') repeat-x;
            animation: wave 15s linear infinite;
        }

        .wave:nth-child(2) {
            bottom: 10px;
            opacity: 0.5;
            animation: wave 20s linear infinite reverse;
        }

        @keyframes wave {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        
        .dashboard-layout,
        .dashboard-header,
        .dashboard-main {
            position: relative;
            z-index: 10;
        }

        .dashboard-layout {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 2rem;
            padding: 2rem;
            min-height: calc(100vh - 100px);
        }

        @media (max-width: 768px) {
            .dashboard-layout {
                grid-template-columns: 1fr;
            }
            
            .dashboard-sidebar {
                position: static;
                width: 100%;
            }
        }

        .dashboard-sidebar {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.7));
            backdrop-filter: blur(15px);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 20px;
            padding: 2rem;
            height: fit-content;
            position: sticky;
            top: 2rem;
        }

        .dashboard-main {
            background: rgba(15, 23, 42, 0.3);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(59, 130, 246, 0.2);
            border-radius: 20px;
            padding: 2rem;
        }

        .dashboard-title {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 2rem;
        }

        .dashboard-section {
            display: none;
        }

        .dashboard-section.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.8));
            backdrop-filter: blur(15px);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 20px;
            padding: 2rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            border-color: #3b82f6;
            box-shadow: 0 20px 60px rgba(59, 130, 246, 0.4);
        }

        .stat-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-icon {
            font-size: 3rem;
            opacity: 0.8;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: #94a3b8;
            margin-top: 0.5rem;
        }

        .sidebar-nav {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .sidebar-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 12px;
            color: #94a3b8;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .sidebar-link:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
            color: #f1f5f9;
            transform: translateX(-4px);
        }

        .sidebar-link.active {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2));
            border-color: #3b82f6;
            color: #f1f5f9;
        }

        .sidebar-icon {
            font-size: 1.5rem;
        }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 20px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: modalSlideIn 0.3s ease;
            max-height: 80vh;
            overflow-y: auto;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            color: #f1f5f9;
        }

        .modal-close {
            background: none;
            border: none;
            color: #94a3b8;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .modal-body {
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: #f1f5f9;
            font-weight: 500;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 1rem;
            background: rgba(15, 23, 42, 0.6);
            border: 2px solid rgba(59, 130, 246, 0.2);
            border-radius: 12px;
            color: #f1f5f9;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(15, 23, 42, 0.8);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .modal-footer {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
        }

        .btn-secondary {
            background: rgba(148, 163, 184, 0.2);
            color: #94a3b8;
            border: 1px solid rgba(148, 163, 184, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(148, 163, 184, 0.3);
            color: #f1f5f9;
        }

        .content-list {
            display: grid;
            gap: 1rem;
        }

        .content-item {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.7), rgba(15, 23, 42, 0.6));
            border: 2px solid rgba(59, 130, 246, 0.2);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .content-item:hover {
            border-color: #3b82f6;
            transform: translateX(-8px);
            box-shadow: 0 10px 40px rgba(59, 130, 246, 0.3);
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.85), rgba(15, 23, 42, 0.75));
        }

        .content-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .content-item-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #f1f5f9;
        }

        .content-item-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        .btn-danger {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .btn-danger:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        .tab-btn {
            padding: 0.75rem 1.5rem;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 12px;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .tab-btn:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: #3b82f6;
            color: #f1f5f9;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-color: #3b82f6;
            color: white;
        }

        .materials-content {
            display: none;
        }

        .materials-content.active {
            display: block;
        }

        /* Enhanced Student Cards Styling */
        .students-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .student-card-enhanced {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.8));
            backdrop-filter: blur(15px);
            border: 2px solid rgba(59, 130, 246, 0.2);
            border-radius: 20px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .student-card-enhanced::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            opacity: 0;
            transition: opacity 0.4s ease;
            pointer-events: none;
        }

        .student-card-enhanced:hover {
            transform: translateY(-8px) scale(1.02);
            border-color: #3b82f6;
            box-shadow: 0 20px 60px rgba(59, 130, 246, 0.4);
        }

        .student-card-enhanced:hover::before {
            opacity: 1;
        }

        .student-card-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            position: relative;
            z-index: 1;
        }

        .student-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            flex-shrink: 0;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .avatar-icon {
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .student-info {
            flex: 1;
            min-width: 0;
        }

        .student-name {
            font-size: 1.125rem;
            font-weight: 700;
            color: #f1f5f9;
            margin: 0 0 0.25rem 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .student-email {
            font-size: 0.875rem;
            color: #94a3b8;
            margin: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .student-status {
            padding: 0.375rem 0.875rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .status-active {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-inactive {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .student-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            position: relative;
            z-index: 1;
        }

        .stat-box {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .stat-box:hover {
            border-color: #3b82f6;
            background: rgba(15, 23, 42, 0.8);
            transform: translateY(-2px);
        }

        .stat-icon {
            font-size: 1.5rem;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .stat-details {
            text-align: center;
        }

        .stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: #f1f5f9;
            line-height: 1;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #94a3b8;
            margin-top: 0.25rem;
        }

        .stat-videos .stat-value {
            color: #3b82f6;
        }

        .stat-exams .stat-value {
            color: #10b981;
        }

        .stat-score .stat-value {
            color: #a78bfa;
        }

        .student-footer {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            padding: 1rem;
            background: rgba(15, 23, 42, 0.4);
            border-radius: 12px;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }

        .footer-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: #94a3b8;
        }

        .footer-icon {
            font-size: 1rem;
        }

        .footer-text {
            flex: 1;
        }

        .student-action {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
        }

        .student-card-enhanced:hover .student-action {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2));
            border-color: #3b82f6;
        }

        .action-text {
            font-size: 0.875rem;
            font-weight: 600;
            color: #3b82f6;
        }

        .action-arrow {
            font-size: 1.25rem;
            color: #3b82f6;
            transition: transform 0.3s ease;
        }

        .student-card-enhanced:hover .action-arrow {
            transform: translateX(-4px);
        }

        @media (max-width: 768px) {
            .students-grid {
                grid-template-columns: 1fr;
            }

            .student-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body class="dashboard-page">
    <canvas id="three-canvas"></canvas>
    <div class="waves">
        <div class="wave"></div>
        <div class="wave"></div>
    </div>
    <a href="#main-content" class="sr-only">ØªØ®Ø·Ù‰ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</a>
    <div id="navbar-placeholder"></div>

    <div class="dashboard-layout">
        <aside class="dashboard-sidebar" role="navigation" aria-label="Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©">
            <nav class="sidebar-nav">
                <button class="sidebar-link active" data-section="overview">
                    <span class="sidebar-icon" aria-hidden="true">ğŸ“Š</span>
                    <span>Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</span>
                </button>
                <button class="sidebar-link" data-section="videos">
                    <span class="sidebar-icon" aria-hidden="true">ğŸ¥</span>
                    <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</span>
                </button>
                <button class="sidebar-link" data-section="exams">
                    <span class="sidebar-icon" aria-hidden="true">ğŸ“‹</span>
                    <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</span>
                </button>
                <button class="sidebar-link" data-section="results">
                    <span class="sidebar-icon" aria-hidden="true">ğŸ“Š</span>
                    <span>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø·Ù„Ø§Ø¨</span>
                </button>
                <button class="sidebar-link" data-section="notes">
                    <span class="sidebar-icon" aria-hidden="true">ğŸ“</span>
                    <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</span>
                </button>
                <button class="sidebar-link" data-section="materials">
                    <span class="sidebar-icon" aria-hidden="true">ğŸ“š</span>
                    <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø°ÙƒØ±Ø§Øª</span>
                </button>
                <button class="sidebar-link" data-section="motivational">
                    <span class="sidebar-icon" aria-hidden="true">ğŸ’¬</span>
                    <span>Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªØ­ÙÙŠØ²ÙŠØ©</span>
                </button>
                <button class="sidebar-link" data-section="students">
                    <span class="sidebar-icon" aria-hidden="true">ğŸ‘¥</span>
                    <span>Ø§Ù„Ø·Ù„Ø§Ø¨</span>
                </button>
            </nav>
        </aside>

        <main id="main-content" class="dashboard-main" role="main">
            <section id="overview-section" class="dashboard-section active">
                <h1 class="dashboard-title fade-in">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</h1>
                
                <div class="stats-grid slide-in" role="list">
                    <article class="stat-card hover-lift" role="listitem">
                        <div class="stat-icon" aria-hidden="true">ğŸ¥</div>
                        <div class="stat-content">
                            <div class="stat-value" id="totalVideos">0</div>
                            <div class="stat-label">ÙÙŠØ¯ÙŠÙˆ</div>
                        </div>
                    </article>
                    
                    <article class="stat-card hover-lift" role="listitem">
                        <div class="stat-icon" aria-hidden="true">ğŸ“‹</div>
                        <div class="stat-content">
                            <div class="stat-value" id="totalExams">0</div>
                            <div class="stat-label">Ø§Ù…ØªØ­Ø§Ù†</div>
                        </div>
                    </article>
                    
                    <article class="stat-card hover-lift" role="listitem">
                        <div class="stat-icon" aria-hidden="true">ğŸ‘¥</div>
                        <div class="stat-content">
                            <div class="stat-value" id="totalStudents">0</div>
                            <div class="stat-label">Ø·Ø§Ù„Ø¨</div>
                        </div>
                    </article>
                    
                    <article class="stat-card hover-lift" role="listitem">
                        <div class="stat-icon" aria-hidden="true">ğŸ“</div>
                        <div class="stat-content">
                            <div class="stat-value" id="totalNotes">0</div>
                            <div class="stat-label">Ù…Ù„Ø§Ø­Ø¸Ø©</div>
                        </div>
                    </article>
                </div>

                <div class="recent-activity">
                    <h2>Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø£Ø®ÙŠØ±</h2>
                    <div id="recent-activity-list"></div>
                </div>
            </section>

            <section id="videos-section" class="dashboard-section">
                <div class="section-header">
                    <h1 class="dashboard-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</h1>
                    <button class="btn btn-primary" id="addVideoBtn">
                        <span aria-hidden="true">â•</span> Ø¥Ø¶Ø§ÙØ© ÙÙŠØ¯ÙŠÙˆ
                    </button>
                </div>
                
                <div id="videosList" class="content-list"></div>
            </section>

            <section id="exams-section" class="dashboard-section">
                <div class="section-header">
                    <h1 class="dashboard-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</h1>
                    <button class="btn btn-primary" id="addExamBtn">
                        <span aria-hidden="true">â•</span> Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù…ØªØ­Ø§Ù†
                    </button>
                </div>
                
                <div id="examsList" class="content-list"></div>
            </section>

            <section id="results-section" class="dashboard-section">
                <h1 class="dashboard-title">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙÙŠ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</h1>
                <div id="resultsFilter" style="margin-bottom: 2rem;">
                    <select id="examFilter" class="form-select" style="max-width: 400px;">
                        <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</option>
                    </select>
                </div>
                <div id="studentResultsList" class="content-list"></div>
            </section>

            <section id="notes-section" class="dashboard-section">
                <div class="section-header">
                    <h1 class="dashboard-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h1>
                    <button class="btn btn-primary" id="addNoteBtn">
                        <span aria-hidden="true">â•</span> Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø©
                    </button>
                </div>
                
                <div id="notesList" class="content-list"></div>
            </section>

            <section id="materials-section" class="dashboard-section">
                <div class="section-header">
                    <h1 class="dashboard-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø°ÙƒØ±Ø§Øª ÙˆØ§Ù„Ù…Ù„Ø§Ø²Ù…</h1>
                    <button class="btn btn-primary" id="addMaterialBtn">
                        <span aria-hidden="true">â•</span> Ø¥Ø¶Ø§ÙØ© Ù…Ø°ÙƒØ±Ø©
                    </button>
                </div>
                
                <div class="materials-tabs" style="display: flex; gap: 1rem; margin-bottom: 2rem;">
                    <button class="tab-btn active" data-grade="1">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„</button>
                    <button class="tab-btn" data-grade="2">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ</button>
                    <button class="tab-btn" data-grade="3">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«</button>
                </div>
                
                <div id="materialsGrade1" class="materials-content active"></div>
                <div id="materialsGrade2" class="materials-content" style="display: none;"></div>
                <div id="materialsGrade3" class="materials-content" style="display: none;"></div>
            </section>

            <!-- Motivational Messages Section -->
            <section id="motivational-section" class="dashboard-section">
                <div class="section-header">
                    <h1 class="dashboard-title">ğŸ’¬ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªØ­ÙÙŠØ²ÙŠØ©</h1>
                    <button class="btn btn-primary" id="addMotivationalBtn">
                        <span aria-hidden="true">â•</span> Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø©
                    </button>
                </div>
                <div class="info-box" style="margin-bottom: 2rem;">
                    <p>ğŸ“Œ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªØ­ÙÙŠØ²ÙŠØ© ØªØ¸Ù‡Ø± Ù„Ù„Ø·Ù„Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø¯Ø®ÙˆÙ„Ù‡Ù… Ø§Ù„Ù…Ù†ØµØ© ÙˆÙƒÙ„ Ø³Ø§Ø¹Ø©</p>
                    <p>ğŸ’¡ Ø£Ø¶Ù Ø±Ø³Ø§Ø¦Ù„ Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ© ÙˆÙ…Ø­ÙØ²Ø© Ù„ØªØ´Ø¬ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ù„Ù…</p>
                </div>
                <div id="motivationalList" class="content-grid"></div>
            </section>

            <section id="students-section" class="dashboard-section">
                <h1 class="dashboard-title">Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</h1>
                <div id="studentsList" class="students-grid"></div>
            </section>
        </main>
    </div>

    <div id="footer-placeholder"></div>

    <script src="../assets/js/components-loader.js"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc, setDoc, getDoc, query, where, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyAU0CCiQNrPEYpTNU4rAwmOmPUZnjb2FoU",
            authDomain: "a-platform-for-learning.firebaseapp.com",
            projectId: "a-platform-for-learning",
            storageBucket: "a-platform-for-learning.firebasestorage.app",
            messagingSenderId: "764579707883",
            appId: "1:764579707883:web:5456e2348354cc58fab7ae",
            measurementId: "G-4P972FP416",
            databaseURL: "https://a-platform-for-learning-default-rtdb.firebaseio.com"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // Make Firebase available globally for the rest of the script
        window.firebaseApp = app;
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseCollection = collection;
        window.firebaseGetDocs = getDocs;
        window.firebaseAddDoc = addDoc;
        window.firebaseDeleteDoc = deleteDoc;
        window.firebaseDoc = doc;
        window.firebaseSetDoc = setDoc;
        window.firebaseGetDoc = getDoc;
        window.firebaseQuery = query;
        window.firebaseWhere = where;
        window.firebaseOrderBy = orderBy;
        
        // Signal that Firebase is ready
        window.firebaseReady = true;
        window.dispatchEvent(new Event('firebaseReady'));
        console.log('âœ… Firebase initialized and ready');
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // ğŸ” Authenticationop
        function checkDashboardAuth() {
            console.log('Checking dashboard authentication...');
            
            // Check if user is logged in
            const currentUserEmail = localStorage.getItem('currentUserEmail');
            const userRole = localStorage.getItem('userRole');
            const currentUser = localStorage.getItem('currentUser');
            
            console.log('Auth data:', { currentUserEmail, userRole, currentUser: !!currentUser });
            
            // If no user data, redirect to login
            if (!currentUserEmail || !currentUser) {
                console.log('No user data found, redirecting to login');
                showToast('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…', 'warning');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 2000);
                return false;
            }
            
            // Check if user is teacher
            if (userRole !== 'teacher') {
                console.log('User is not a teacher, redirecting to profile');
                showToast('Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù…Ø®ØµØµØ© Ù„Ù„Ù…Ø¯Ø±Ø³ÙŠÙ† ÙÙ‚Ø·', 'error');
                setTimeout(() => {
                    window.location.href = 'profile.html';
                }, 2000);
                return false;
            }
            
            // Special check for teacher credentials
            try {
                const userData = JSON.parse(currentUser);
                const isValidTeacher = (
                    currentUserEmail === 'mohamednaser@gmail.com' ||
                    userRole === 'teacher'
                );
                
                if (!isValidTeacher) {
                    console.log('âŒ Invalid teacher credentials');
                    showToast('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…Ø¯Ø±Ø³ ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 2000);
                    return false;
                }
                
                console.log('Teacher authentication successful');
                showToast('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø£Ø³ØªØ§Ø° ' + (userData.name || 'Ù…Ø­Ù…Ø¯'), 'success');
                return true;
                
            } catch (error) {
                console.error('Error parsing user data:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 2000);
                return false;
            }
      }
        
        // Run authentication check immediately
        if (!checkDashboardAuth()) {
            // Stop further script execution if auth fails
            throw new Error('Authentication failed');
        }
        
        // Toast notification system
        function showToast(message, type = 'info', duration = 3000) {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            const icon = {
                success: 'âœ…',
                error: 'âŒ',
                warning: 'âš ï¸',
                info: 'â„¹ï¸'
            }[type];
            
            toast.innerHTML = `
                <div class="toast-content">
                    <span class="toast-icon">${icon}</span>
                    <span class="toast-message">${message}</span>
                    <button class="toast-close" onclick="this.parentElement.parentElement.remove()">Ã—</button>
                </div>
            `;
            
            // Add toast styles if not already added
            if (!document.getElementById('toast-styles')) {
                const styles = document.createElement('style');
                styles.id = 'toast-styles';
                styles.textContent = `
                    .toast {
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: rgba(30, 41, 59, 0.95);
                        backdrop-filter: blur(10px);
                        border-radius: 12px;
                        padding: 1rem;
                        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                        z-index: 10000;
                        animation: slideInRight 0.3s ease;
                        max-width: 400px;
                        border-left: 4px solid;
                    }
                    
                    .toast-success { border-left-color: #10b981; }
                    .toast-error { border-left-color: #ef4444; }
                    .toast-warning { border-left-color: #f59e0b; }
                    .toast-info { border-left-color: #3b82f6; }
                    
                    .toast-content {
                        display: flex;
                        align-items: center;
                        gap: 0.75rem;
                        color: #f1f5f9;
                    }
                    
                    .toast-icon {
                        font-size: 1.2rem;
                        flex-shrink: 0;
                    }
                    
                 .toast-message {
                        flex: 1;
                        font-size: 0.95rem;
                    }
                    
                    .toast-close {
                        background: none;
                        border: none;
                        color: #94a3b8;
                        font-size: 1.2rem;
                        cursor: pointer;
                        padding: 0;
                        width: 24px;
                        height: 24px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border-radius: 50%;
                        transition: all 0.3s ease;
                    }
                    
                    .toast-close:hover {
                        background: rgba(148, 163, 184, 0.2);
                        color: #f1f5f9;
                    }
                    
                    @keyframes slideInRight {
                        from {
                            opacity: 0;
                            transform: translateX(100%);
                        }
                        to {
                            opacity: 1;
                            transform: translateX(0);
                        }
                    }
                `;
                document.head.appendChild(styles);
            }
            
            document.body.appendChild(toast);
            
            // Auto remove after duration
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.style.animation = 'slideInRight 0.3s ease reverse';
                    setTimeout(() => toast.remove(), 300);
                }
            }, duration);
        }

        // Three.js Scene - Philosophy Brain Model
        const canvas = document.getElementById('three-canvas');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });

        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        camera.position.z = 5;

        // Create Brain
        const brainGeometry = new THREE.IcosahedronGeometry(0.8, 1);
        const brainMaterial = new THREE.MeshNormalMaterial({ wireframe: true, opacity: 0.3, transparent: true });
        const brain = new THREE.Mesh(brainGeometry, brainMaterial);
        scene.add(brain);

        // Create Logic Symbols
        const symbolGeometry = new THREE.OctahedronGeometry(0.25);
        const symbolMaterial = new THREE.MeshNormalMaterial({ wireframe: false, opacity: 0.4, transparent: true });
        
        const symbols = [];
        for (let i = 0; i < 6; i++) {
            const symbol = new THREE.Mesh(symbolGeometry, symbolMaterial);
            const angle = (i / 6) * Math.PI * 2;
            symbol.position.x = Math.cos(angle) * 2;
            symbol.position.y = Math.sin(angle) * 2;
            symbols.push(symbol);
            scene.add(symbol);
        }

        // Create Particles
        const particlesGeometry = new THREE.BufferGeometry();
        const particlesCount = 500;
        const posArray = new Float32Array(particlesCount * 3);

        for (let i = 0; i < particlesCount * 3; i++) {
            posArray[i] = (Math.random() - 0.5) * 10;
        }

        particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        const particlesMaterial = new THREE.PointsMaterial({ size: 0.02, color: 0x3b82f6, opacity: 0.6, transparent: true });
        const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
        scene.add(particlesMesh);

        // Animation
        let time = 0;
        function animate() {
            requestAnimationFrame(animate);
            time += 0.01;
            
            brain.rotation.x += 0.005;
            brain.rotation.y += 0.005;
            
            symbols.forEach((symbol, i) => {
                const angle = (i / 6) * Math.PI * 2 + time * 0.3;
                symbol.position.x = Math.cos(angle) * 2;
                symbol.position.y = Math.sin(angle) * 2;
                symbol.rotation.x += 0.02;
                symbol.rotation.y += 0.02;
            });
            
            particlesMesh.rotation.y += 0.0005;
            renderer.render(scene, camera);
        }

        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Dashboard Functionality
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Dashboard loaded successfully!');
            
            // Get Firebase instances from global scope
            const db = window.firebaseDb;
            const collection = window.firebaseCollection;
            const getDocs = window.firebaseGetDocs;
            const addDoc = window.firebaseAddDoc;
            const deleteDoc = window.firebaseDeleteDoc;
            const doc = window.firebaseDoc;
            const setDoc = window.firebaseSetDoc;
            
            // Load Data from Firebase Firestore
            let videos = [];
            let exams = [];
            let notes = [];
            let materials = [];
            let examResults = [];
            
            // Load videos from Firebase
            try {
                const videosSnapshot = await getDocs(collection(db, 'videos'));
                videos = videosSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log('Loaded videos from Firebase:', videos.length);
            } catch (e) {
                console.error('Error loading videos from Firebase:', e);
            }
            
            // Load exams from Firebase
            try {
                const examsSnapshot = await getDocs(collection(db, 'exams'));
                exams = examsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log('Loaded exams from Firebase:', exams.length);
            } catch (e) {
                console.error('Error loading exams from Firebase:', e);
            }
            
            // Load notes from Firebase
            try {
                const notesSnapshot = await getDocs(collection(db, 'notes'));
                notes = notesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log('Loaded notes from Firebase:', notes.length);
            } catch (e) {
                console.error('Error loading notes from Firebase:', e);
            }
            
            // Load materials from Firebase
            try {
                const materialsSnapshot = await getDocs(collection(db, 'materials'));
                materials = materialsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log('Loaded materials from Firebase:', materials.length);
            } catch (e) {
                console.error('Error loading materials from Firebase:', e);
            }
            
            // Load exam results from Firebase
            try {
                const resultsSnapshot = await getDocs(collection(db, 'examResults'));
                examResults = resultsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log('Loaded exam results from Firebase:', examResults.length);
            } catch (e) {
                console.error('Error loading exam results from Firebase:', e);
            }
            
            console.log('Loaded data:', {
                videos: videos.length,
                exams: exams.length,
                notes: notes.length,
                materials: materials.length,
                examResults: examResults.length
            });
            
            // Firebase helper functions - no need for saveData anymore
            // Data is saved directly to Firebase when adding/updating items

            // Modal Functions
            function createModal(title, content, onSubmit) {
                console.log('ğŸ”„ Creating modal:', title);
                
                const modal = document.createElement('div');
                modal.className = 'modal-overlay active';
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2 class="modal-title">${title}</h2>
                            <button class="modal-close" aria-label="Ø¥ØºÙ„Ø§Ù‚">âœ•</button>
                        </div>
                        <div class="modal-body">
                            ${content}
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary modal-cancel">Ø¥Ù„ØºØ§Ø¡</button>
                            <button class="btn btn-primary modal-submit">Ø­ÙØ¸</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                const closeBtn = modal.querySelector('.modal-close');
                const cancelBtn = modal.querySelector('.modal-cancel');
                const submitBtn = modal.querySelector('.modal-submit');
                
                function closeModal() {
                    console.log('ğŸ”„ Closing modal');
                    modal.classList.remove('active');
                    setTimeout(() => modal.remove(), 300);
                }
                
                closeBtn.addEventListener('click', closeModal);
                cancelBtn.addEventListener('click', closeModal);
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) closeModal();
                });
                
                submitBtn.addEventListener('click', () => {
                    console.log('Modal submit clicked');
                    submitBtn.disabled = true;
                    submitBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
                    
                    try {
                        const result = onSubmit(closeModal);
                        
                        // If result is a promise, wait for it
                        if (result && typeof result.then === 'function') {
                            result.then((success) => {
                                if (success !== false) {
                                    closeModal();
                                } else {
                                    submitBtn.disabled = false;
                                    submitBtn.textContent = 'Ø­ÙØ¸';
                                }
                            }).catch(() => {
                                submitBtn.disabled = false;
                                submitBtn.textContent = 'Ø­ÙØ¸';
                            });
                        } else if (result !== false) {
                            closeModal();
                        } else {
                            submitBtn.disabled = false;
                            submitBtn.textContent = 'Ø­ÙØ¸';
                        }
                    } catch (error) {
                        console.error('Error in modal submit:', error);
                        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error.message, 'error');
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'Ø­ÙØ¸';
                    }
                });
                
                return modal;
            }

            function createConfirmModal(title, message, onConfirm) {
                const modal = document.createElement('div');
                modal.className = 'modal-overlay active';
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2 class="modal-title">${title}</h2>
                            <button class="modal-close" aria-label="Ø¥ØºÙ„Ø§Ù‚">âœ•</button>
                        </div>
                        <div class="modal-body">
                            <p style="color: #f1f5f9; font-size: 1.1rem;">${message}</p>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary modal-cancel">Ø¥Ù„ØºØ§Ø¡</button>
                            <button class="btn btn-danger modal-confirm">ØªØ£ÙƒÙŠØ¯</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                const closeBtn = modal.querySelector('.modal-close');
                const cancelBtn = modal.querySelector('.modal-cancel');
                const confirmBtn = modal.querySelector('.modal-confirm');
                
                function closeModal() {
                    modal.classList.remove('active');
                    setTimeout(() => modal.remove(), 300);
                }
                
                closeBtn.addEventListener('click', closeModal);
                cancelBtn.addEventListener('click', closeModal);
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) closeModal();
                });
                
                confirmBtn.addEventListener('click', () => {
                    onConfirm();
                    closeModal();
                });
            }

            // Sidebar Navigation
            const sidebarLinks = document.querySelectorAll('.sidebar-link');
            const sections = document.querySelectorAll('.dashboard-section');
            
            console.log('ğŸ”— Sidebar links found:', sidebarLinks.length);
            console.log('ğŸ“„ Sections found:', sections.length);
            
            sidebarLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const sectionId = link.getAttribute('data-section');
                    
                    console.log('ğŸ”„ Switching to section:', sectionId);
                    
                    sidebarLinks.forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                    
                    sections.forEach(s => s.classList.remove('active'));
                    const targetSection = document.getElementById(`${sectionId}-section`);
                    if (targetSection) {
                        targetSection.classList.add('active');
                        console.log('âœ… Section activated:', sectionId);
                        
                        // Load students when students section is opened
                        if (sectionId === 'students') {
                            loadStudents();
                        }
                        
                        // Load motivational messages when section is opened
                        if (sectionId === 'motivational') {
                            loadMotivationalMessages();
                        }
                    } else {
                        console.error('âŒ Section not found:', `${sectionId}-section`);
                    }
                });
            });

            // Video source selection handler
            document.addEventListener('change', function(e) {
                if (e.target.id === 'videoSource') {
                    const source = e.target.value;
                    const youtubeGroup = document.getElementById('youtubeGroup');
                    const uploadGroup = document.getElementById('uploadGroup');
                    
                    if (source === 'youtube') {
                        youtubeGroup.style.display = 'block';
                        uploadGroup.style.display = 'none';
                        document.getElementById('videoUrl').required = true;
                        document.getElementById('videoFile').required = false;
                    } else if (source === 'upload') {
                        youtubeGroup.style.display = 'none';
                        uploadGroup.style.display = 'block';
                        document.getElementById('videoUrl').required = false;
                        document.getElementById('videoFile').required = true;
                    } else {
                        youtubeGroup.style.display = 'none';
                        uploadGroup.style.display = 'none';
                        document.getElementById('videoUrl').required = false;
                        document.getElementById('videoFile').required = false;
                    }
                }
                
                if (e.target.id === 'materialSource') {
                    const source = e.target.value;
                    const uploadGroup = document.getElementById('uploadMaterialGroup');
                    const linkGroup = document.getElementById('linkMaterialGroup');
                    
                    if (source === 'upload') {
                        uploadGroup.style.display = 'block';
                        linkGroup.style.display = 'none';
                        document.getElementById('materialFile').required = true;
                        document.getElementById('materialUrl').required = false;
                    } else if (source === 'drive' || source === 'external') {
                        uploadGroup.style.display = 'none';
                        linkGroup.style.display = 'block';
                        document.getElementById('materialFile').required = false;
                        document.getElementById('materialUrl').required = true;
                    } else {
                        uploadGroup.style.display = 'none';
                        linkGroup.style.display = 'none';
                        document.getElementById('materialFile').required = false;
                        document.getElementById('materialUrl').required = false;
                    }
                }
            });

            // Load Students Function - Enhanced with tracking
            async function loadStudents() {
                console.log('ğŸ“Š Loading students...');
                const studentsList = document.getElementById('studentsList');
                if (!studentsList) {
                    console.error('âŒ Students list element not found');
                    return;
                }
                
                studentsList.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 2rem; color: #94a3b8;">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨...</div>';
                
                try {
                    // Get Firebase instances
                    const db = window.firebaseDb;
                    const collection = window.firebaseCollection;
                    const getDocs = window.firebaseGetDocs;
                    const query = window.firebaseQuery;
                    const where = window.firebaseWhere;
                    
                    if (!db || !collection || !getDocs) {
                        throw new Error('Firebase not initialized');
                    }
                    
                    // Load all users from Firestore
                    const usersSnapshot = await getDocs(collection(db, 'users'));
                    const students = [];
                    
                    console.log('ğŸ‘¥ Found users:', usersSnapshot.size);
                    
                    for (const userDoc of usersSnapshot.docs) {
                        const userData = userDoc.data();
                        
                        // Only include students (not teachers)
                        if (userData.role !== 'teacher' && userData.role !== 'admin') {
                            // Get student's exam results
                            const examResultsQuery = query(
                                collection(db, 'examResults'),
                                where('userId', '==', userDoc.id)
                            );
                            const examResultsSnapshot = await getDocs(examResultsQuery);
                            
                            // Get student's video watches
                            const videoWatchesQuery = query(
                                collection(db, 'videoWatches'),
                                where('userId', '==', userDoc.id)
                            );
                            const videoWatchesSnapshot = await getDocs(videoWatchesQuery);
                            
                            // Calculate statistics
                            const totalExams = examResultsSnapshot.size;
                            const passedExams = examResultsSnapshot.docs.filter(doc => doc.data().passed).length;
                            const totalVideos = videoWatchesSnapshot.size;
                            
                            // Calculate average score
                            let averageScore = 0;
                            if (totalExams > 0) {
                                const totalScore = examResultsSnapshot.docs.reduce((sum, doc) => sum + (doc.data().score || 0), 0);
                                averageScore = Math.round(totalScore / totalExams);
                            }
                            
                            // Get last activity
                            let lastActivity = userData.createdAt || userData.lastLogin || new Date().toISOString();
                            
                            students.push({
                                id: userDoc.id,
                                name: userData.name || userData.displayName || 'Ø·Ø§Ù„Ø¨',
                                email: userData.email || '',
                                joinDate: userData.createdAt ? new Date(userData.createdAt).toLocaleDateString('ar-EG') : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                                lastActivity: new Date(lastActivity).toLocaleDateString('ar-EG'),
                                totalExams: totalExams,
                                passedExams: passedExams,
                                totalVideos: totalVideos,
                                averageScore: averageScore,
                                status: userData.active !== false ? 'Ù†Ø´Ø·' : 'Ù…Ø¹Ù„Ù‚'
                            });
                        }
                    }
                    
                    console.log('âœ… Loaded students:', students.length);
                    
                    if (students.length === 0) {
                        studentsList.innerHTML = `
                            <div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: #94a3b8;">
                                <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ‘¥</div>
                                <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù…Ø³Ø¬Ù„ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                                <p style="font-size: 0.9rem; margin-top: 0.5rem;">Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„Ø·Ù„Ø§Ø¨ Ù‡Ù†Ø§ Ø¹Ù†Ø¯ ØªØ³Ø¬ÙŠÙ„Ù‡Ù… ÙÙŠ Ø§Ù„Ù…Ù†ØµØ©</p>
                            </div>
                        `;
                        return;
                    }
                    
                    // Sort by last activity (most recent first)
                    students.sort((a, b) => new Date(b.lastActivity) - new Date(a.lastActivity));
                    
                    studentsList.innerHTML = students.map(student => `
                        <div class="student-card-enhanced" onclick="viewStudentDetails('${student.id}')">
                            <div class="student-card-header">
                                <div class="student-avatar">
                                    <span class="avatar-icon">ğŸ‘¤</span>
                                </div>
                                <div class="student-info">
                                    <h3 class="student-name">${student.name}</h3>
                                    <p class="student-email">${student.email}</p>
                                </div>
                                <span class="student-status ${student.status === 'Ù†Ø´Ø·' ? 'status-active' : 'status-inactive'}">${student.status}</span>
                            </div>
                            
                            <div class="student-stats">
                                <div class="stat-box stat-videos">
                                    <div class="stat-icon">ğŸ¥</div>
                                    <div class="stat-details">
                                        <div class="stat-value">${student.totalVideos}</div>
                                        <div class="stat-label">ÙÙŠØ¯ÙŠÙˆ</div>
                                    </div>
                                </div>
                                
                                <div class="stat-box stat-exams">
                                    <div class="stat-icon">ğŸ“</div>
                                    <div class="stat-details">
                                        <div class="stat-value">${student.passedExams}/${student.totalExams}</div>
                                        <div class="stat-label">Ø§Ù…ØªØ­Ø§Ù†</div>
                                    </div>
                                </div>
                                
                                <div class="stat-box stat-score">
                                    <div class="stat-icon">â­</div>
                                    <div class="stat-details">
                                        <div class="stat-value">${student.averageScore}%</div>
                                        <div class="stat-label">Ø§Ù„Ù…Ø¹Ø¯Ù„</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="student-footer">
                                <div class="footer-item">
                                    <span class="footer-icon">ğŸ“…</span>
                                    <span class="footer-text">Ø§Ù†Ø¶Ù…: ${student.joinDate}</span>
                                </div>
                                <div class="footer-item">
                                    <span class="footer-icon">ğŸ•</span>
                                    <span class="footer-text">Ø¢Ø®Ø± Ù†Ø´Ø§Ø·: ${student.lastActivity}</span>
                                </div>
                            </div>
                            
                            <div class="student-action">
                                <span class="action-text">Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„</span>
                                <span class="action-arrow">â†</span>
                            </div>
                        </div>
                    `).join('');
                    
                    // Update students count if element exists
                    const totalStudentsEl = document.getElementById('totalStudents');
                    if (totalStudentsEl) {
                        totalStudentsEl.textContent = students.length;
                    }
                    
                } catch (error) {
                    console.error('âŒ Error loading students:', error);
                    studentsList.innerHTML = `
                        <div style="grid-column: 1/-1; text-align: center; padding: 2rem; color: #f87171;">
                            <div style="font-size: 2rem; margin-bottom: 1rem;">âš ï¸</div>
                            <p style="font-weight: bold;">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨</p>
                            <p style="font-size: 0.875rem; margin-top: 0.5rem; color: #94a3b8;">${error.message}</p>
                            <button onclick="loadStudents()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer;">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
                        </div>
                    `;
                }
            }
            
            // View student details
            window.viewStudentDetails = async function(studentId) {
                try {
                    // Get Firebase instances
                    const db = window.firebaseDb;
                    const getDoc = window.firebaseGetDoc;
                    const doc = window.firebaseDoc;
                    const getDocs = window.firebaseGetDocs;
                    const collection = window.firebaseCollection;
                    const query = window.firebaseQuery;
                    const where = window.firebaseWhere;
                    
                    if (!db || !getDoc || !doc) {
                        throw new Error('Firebase not initialized');
                    }
                    
                    console.log('ğŸ“Š Loading student details for:', studentId);
                    
                    // Get student data
                    const studentDoc = await getDoc(doc(db, 'users', studentId));
                    
                    if (!studentDoc.exists()) {
                        showToast('Ø§Ù„Ø·Ø§Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                        return;
                    }
                    
                    const student = studentDoc.data();
                    console.log('âœ… Student data loaded:', student);
                    
                    // Get exam results (without orderBy to avoid index requirement)
                    const examResultsQuery = query(
                        collection(db, 'examResults'),
                        where('userId', '==', studentId)
                    );
                    const examResultsSnapshot = await getDocs(examResultsQuery);
                    
                    // Sort exam results manually by completedAt (descending)
                    const examResults = examResultsSnapshot.docs
                        .map(doc => ({ id: doc.id, ...doc.data() }))
                        .sort((a, b) => new Date(b.completedAt) - new Date(a.completedAt));
                    
                    console.log('âœ… Exam results loaded:', examResults.length);
                    
                    // Get video watches (without orderBy to avoid index requirement)
                    const videoWatchesQuery = query(
                        collection(db, 'videoWatches'),
                        where('userId', '==', studentId)
                    );
                    const videoWatchesSnapshot = await getDocs(videoWatchesQuery);
                    
                    // Sort video watches manually by watchedAt (descending)
                    const videoWatches = videoWatchesSnapshot.docs
                        .map(doc => ({ id: doc.id, ...doc.data() }))
                        .sort((a, b) => {
                            const dateA = a.watchedAt?.toDate ? a.watchedAt.toDate() : new Date(a.watchedAt);
                            const dateB = b.watchedAt?.toDate ? b.watchedAt.toDate() : new Date(b.watchedAt);
                            return dateB - dateA;
                        });
                    
                    console.log('âœ… Video watches loaded:', videoWatches.length);
                    
                    // Create modal
                    const modal = document.createElement('div');
                    modal.className = 'modal active';
                    modal.innerHTML = `
                        <div class="modal-overlay"></div>
                        <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
                            <div class="modal-header">
                                <h2>ğŸ“Š ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
                                <button class="modal-close">Ã—</button>
                            </div>
                            
                            <div style="margin-bottom: 2rem;">
                                <h3 style="color: #3b82f6; font-size: 1.5rem; margin-bottom: 0.5rem;">ğŸ‘¤ ${student.name || 'Ø·Ø§Ù„Ø¨'}</h3>
                                <p style="color: #94a3b8;">ğŸ“§ ${student.email || ''}</p>
                                <p style="color: #94a3b8; font-size: 0.875rem; margin-top: 0.5rem;">
                                    ğŸ“… Ø§Ù†Ø¶Ù…: ${student.createdAt ? new Date(student.createdAt).toLocaleDateString('ar-EG') : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                                </p>
                            </div>
                            
                            <!-- Statistics -->
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                                <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 12px; text-align: center;">
                                    <div style="font-size: 2rem; font-weight: bold; color: #3b82f6;">${videoWatches.length}</div>
                                    <div style="color: #94a3b8; font-size: 0.875rem;">ÙÙŠØ¯ÙŠÙˆ Ù…Ø´Ø§Ù‡Ø¯</div>
                                </div>
                                <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 12px; text-align: center;">
                                    <div style="font-size: 2rem; font-weight: bold; color: #10b981;">${examResults.length}</div>
                                    <div style="color: #94a3b8; font-size: 0.875rem;">Ø§Ù…ØªØ­Ø§Ù† Ù…Ø­Ù„ÙˆÙ„</div>
                                </div>
                                <div style="background: rgba(139, 92, 246, 0.1); padding: 1rem; border-radius: 12px; text-align: center;">
                                    <div style="font-size: 2rem; font-weight: bold; color: #a78bfa;">
                                        ${examResults.length > 0 ? Math.round(examResults.reduce((sum, r) => sum + (r.score || 0), 0) / examResults.length) : 0}%
                                    </div>
                                    <div style="color: #94a3b8; font-size: 0.875rem;">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</div>
                                </div>
                            </div>
                            
                            <!-- Exam Results -->
                            <div style="margin-bottom: 2rem;">
                                <h3 style="color: #3b82f6; margin-bottom: 1rem;">ğŸ“ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</h3>
                                ${examResults.length === 0 ? 
                                    '<p style="color: #94a3b8; text-align: center; padding: 1rem;">Ù„Ù… ÙŠØ­Ù„ Ø£ÙŠ Ø§Ù…ØªØ­Ø§Ù† Ø¨Ø¹Ø¯</p>' :
                                    examResults.map(result => {
                                        return `
                                            <div style="background: rgba(15, 23, 42, 0.5); padding: 1rem; border-radius: 8px; margin-bottom: 0.5rem; border-right: 4px solid ${result.passed ? '#10b981' : '#ef4444'};">
                                                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                                                    <div style="flex: 1; min-width: 200px;">
                                                        <h4 style="color: #f1f5f9; margin-bottom: 0.25rem;">${result.examTitle}</h4>
                                                        <p style="color: #94a3b8; font-size: 0.875rem;">
                                                            ğŸ“… ${new Date(result.completedAt).toLocaleDateString('ar-EG')} - 
                                                            ${result.correctAnswers}/${result.totalQuestions} ØµØ­ÙŠØ­
                                                        </p>
                                                    </div>
                                                    <div style="text-align: left;">
                                                        <div style="font-size: 1.5rem; font-weight: bold; color: ${result.passed ? '#10b981' : '#ef4444'};">
                                                            ${result.score}%
                                                        </div>
                                                        <span class="badge ${result.passed ? 'badge-success' : 'badge-danger'}">
                                                            ${result.passed ? 'âœ… Ù†Ø§Ø¬Ø­' : 'âŒ Ø±Ø§Ø³Ø¨'}
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')
                                }
                            </div>
                            
                            <!-- Video Watches -->
                            <div>
                                <h3 style="color: #3b82f6; margin-bottom: 1rem;">ğŸ¥ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©</h3>
                                ${videoWatches.length === 0 ? 
                                    '<p style="color: #94a3b8; text-align: center; padding: 1rem;">Ù„Ù… ÙŠØ´Ø§Ù‡Ø¯ Ø£ÙŠ ÙÙŠØ¯ÙŠÙˆ Ø¨Ø¹Ø¯</p>' :
                                    videoWatches.slice(0, 10).map(watch => {
                                        const watchDate = watch.watchedAt?.toDate ? watch.watchedAt.toDate() : new Date(watch.watchedAt);
                                        return `
                                            <div style="background: rgba(15, 23, 42, 0.5); padding: 1rem; border-radius: 8px; margin-bottom: 0.5rem; border-right: 4px solid #3b82f6;">
                                                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                                                    <div style="flex: 1; min-width: 200px;">
                                                        <h4 style="color: #f1f5f9; margin-bottom: 0.25rem;">${watch.videoTitle}</h4>
                                                        <p style="color: #94a3b8; font-size: 0.875rem;">
                                                            ğŸ“… ${watchDate.toLocaleDateString('ar-EG')}
                                                        </p>
                                                    </div>
                                                    <span class="badge badge-success">âœ… Ù…ÙƒØªÙ…Ù„</span>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')
                                }
                                ${videoWatches.length > 10 ? `<p style="color: #94a3b8; text-align: center; margin-top: 1rem; font-size: 0.875rem;">ÙˆØ£ÙƒØ«Ø± Ù…Ù† ${videoWatches.length - 10} ÙÙŠØ¯ÙŠÙˆ Ø¢Ø®Ø±...</p>` : ''}
                            </div>
                            
                            <div class="form-actions" style="margin-top: 2rem;">
                                <button type="button" class="btn btn-secondary close-modal">Ø¥ØºÙ„Ø§Ù‚</button>
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(modal);
                    
                    const closeBtn = modal.querySelector('.modal-close');
                    const cancelBtn = modal.querySelector('.close-modal');
                    const overlay = modal.querySelector('.modal-overlay');
                    
                    const closeModal = () => modal.remove();
                    
                    closeBtn.addEventListener('click', closeModal);
                    cancelBtn.addEventListener('click', closeModal);
                    overlay.addEventListener('click', closeModal);
                    
                } catch (error) {
                    console.error('Error viewing student details:', error);
                    showToast('Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨: ' + error.message, 'error');
                }
            };
            
            function extractNameFromEmail(email) {
                const namePart = email.split('@')[0];
                return namePart
                    .replace(/[._]/g, ' ')
                    .split(' ')
                    .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
                    .join(' ');
            }

            // Add Video Button
            const addVideoBtn = document.getElementById('addVideoBtn');
            if (addVideoBtn) {
                console.log('Add Video Button found');
                addVideoBtn.addEventListener('click', function() {
                    console.log('Add Video button clicked');
                    createModal(
                        'Ø¥Ø¶Ø§ÙØ© ÙÙŠØ¯ÙŠÙˆ Ø¬Ø¯ÙŠØ¯',
                        `
                        <form id="videoForm">
                            <div class="form-group">
                                <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</label>
                                <input type="text" class="form-input" id="videoTitle" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ù…ØµØ¯Ø± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</label>
                                <select class="form-select" id="videoSource" required>
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ØµØ¯Ø±</option>
                                    <option value="youtube">Ø±Ø§Ø¨Ø· YouTube</option>
                                    <option value="upload">Ø±ÙØ¹ Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²</option>
                                </select>
                            </div>
                            <div class="form-group" id="youtubeGroup" style="display: none;">
                                <label class="form-label">Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (YouTube)</label>
                                <input type="url" class="form-input" id="videoUrl" placeholder="https://www.youtube.com/watch?v=...">
                            </div>
                            <div class="form-group" id="uploadGroup" style="display: none;">
                                <label class="form-label">Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</label>
                                <input type="file" class="form-input" id="videoFile" accept="video/*">
                                <p style="color: #94a3b8; font-size: 0.875rem; margin-top: 0.5rem;">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: 50 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª</p>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§Ù„Ù…Ø­ØªÙˆÙ‰/Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                                <textarea class="form-textarea" id="videoNotes" rows="4" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ø®ØªÙŠØ§Ø±ÙŠØ© Ø­ÙˆÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ"></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§Ù„Ù…Ø¯Ø© (Ø¯Ù‚Ø§Ø¦Ù‚)</label>
                                <input type="number" class="form-input" id="videoDuration" min="0" placeholder="0" required>
                            </div>
                        </form>
                        `,
                        () => {
                            console.log('Processing video form...');
                            const title = document.getElementById('videoTitle').value.trim();
                            const source = document.getElementById('videoSource').value;
                            const url = document.getElementById('videoUrl').value.trim();
                            const fileInput = document.getElementById('videoFile');
                            const notes = document.getElementById('videoNotes').value.trim();
                            const duration = document.getElementById('videoDuration').value;
                            
                            console.log('ğŸ“¹ Form data:', { title, source, url, hasFile: !!fileInput.files[0], notes, duration });
                            
                            if (!title || !source || !duration) {
                                showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                                return false;
                            }
                            
                            let videoUrl = '';
                            
                            if (source === 'youtube') {
                                if (!url) {
                                    showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· YouTube', 'error');
                                    return false;
                                }
                                videoUrl = url;
                            } else if (source === 'upload') {
                                if (!fileInput.files || !fileInput.files[0]) {
                                    showToast('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ', 'error');
                                    return false;
                                }
                                
                                const file = fileInput.files[0];
                                if (file.size > 50 * 1024 * 1024) {
                                    showToast('Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 50 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª)', 'error');
                                    return false;
                                }
                                
                                // For demo, we'll use a placeholder URL
                                videoUrl = URL.createObjectURL(file);
                            }
                            
                            const newVideo = {
                                title,
                                videoUrl,
                                source,
                                notes,
                                duration: parseInt(duration),
                                createdAt: new Date().toISOString()
                            };
                            
                            console.log('Adding video to Firebase:', newVideo);
                            
                            // Save to Firebase
                            return addDoc(collection(db, 'videos'), newVideo)
                                .then((docRef) => {
                                    newVideo.id = docRef.id;
                                    videos.push(newVideo);
                                    renderVideos();
                                    updateStats();
                                    showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                                    console.log('Video added successfully to Firebase');
                                    return true;
                                })
                                .catch((error) => {
                                    console.error('Failed to save video to Firebase:', error);
                                    showToast('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ: ' + error.message, 'error');
                                    return false;
                                });
                        }
                    );
                });
            } else {
                console.error('Add Video Button not found!');
            }

            // Add Exam Button
            let questionCount = 0;
            
            const addExamBtn = document.getElementById('addExamBtn');
            if (addExamBtn) {
                console.log('Add Exam Button found');
                addExamBtn.addEventListener('click', function() {
                    console.log('Add Exam button clicked');
                    questionCount = 0; // Reset question count
                    
                    createModal(
                        'Ø¥Ø¶Ø§ÙØ© Ø§Ù…ØªØ­Ø§Ù† Ø¬Ø¯ÙŠØ¯',
                        `
                        <style>
                            .btn-sm {
                                padding: 0.5rem 1rem;
                                font-size: 0.875rem;
                            }
                            .question-item {
                                animation: slideIn 0.3s ease;
                            }
                            @keyframes slideIn {
                                from {
                                    opacity: 0;
                                    transform: translateY(-10px);
                                }
                                to {
                                    opacity: 1;
                                    transform: translateY(0);
                                }
                            }
                            #questionsContainer::-webkit-scrollbar {
                                width: 8px;
                            }
                            #questionsContainer::-webkit-scrollbar-track {
                                background: rgba(15, 23, 42, 0.5);
                                border-radius: 4px;
                            }
                            #questionsContainer::-webkit-scrollbar-thumb {
                                background: rgba(59, 130, 246, 0.5);
                                border-radius: 4px;
                            }
                            #questionsContainer::-webkit-scrollbar-thumb:hover {
                                background: rgba(59, 130, 246, 0.7);
                            }
                        </style>
                        <form id="examForm">
                            <div class="form-group">
                                <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</label>
                                <input type="text" class="form-input" id="examTitle" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§Ù„Ù…Ø¯Ø© (Ø¯Ù‚Ø§Ø¦Ù‚)</label>
                                <input type="number" class="form-input" id="examDuration" min="0" placeholder="60" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§Ù„ÙˆØµÙ</label>
                                <textarea class="form-textarea" id="examDescription" rows="3" placeholder="ÙˆØµÙ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†"></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</label>
                                <select class="form-select" id="examType" required>
                                    <option value="external">Ø±Ø§Ø¨Ø· Ø®Ø§Ø±Ø¬ÙŠ (Google Forms)</option>
                                    <option value="internal">Ø§Ù…ØªØ­Ø§Ù† Ù…Ø¯Ù…Ø¬ (Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù†ØµØ©)</option>
                                </select>
                            </div>
                            
                            <!-- Ù„Ù„Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ -->
                            <div class="form-group" id="externalExamGroup">
                                <label class="form-label">Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</label>
                                <input type="url" class="form-input" id="examUrl" placeholder="https://forms.google.com/...">
                                <p style="color: #94a3b8; font-size: 0.875rem; margin-top: 0.5rem;">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Google Forms Ø£Ùˆ Ø£ÙŠ Ù…Ù†ØµØ© Ø£Ø®Ø±Ù‰</p>
                            </div>
                            
                            <!-- Ù„Ù„Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ù…Ø¯Ù…Ø¬ -->
                            <div class="form-group" id="internalExamGroup" style="display: none;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                    <label class="form-label" style="margin: 0;">Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</label>
                                    <button type="button" class="btn btn-sm btn-primary" id="addQuestionBtn">â• Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„</button>
                                </div>
                                <div id="questionsContainer" style="max-height: 400px; overflow-y: auto;"></div>
                            </div>
                        </form>
                        `,
                        () => {
                            console.log('Processing exam form...');
                            const examType = document.getElementById('examType').value;
                            const title = document.getElementById('examTitle').value.trim();
                            const duration = document.getElementById('examDuration').value;
                            const description = document.getElementById('examDescription').value.trim();
                            
                            if (!title || !duration) {
                                showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                                return false;
                            }
                            
                            if (examType === 'external') {
                                // Ø§Ù…ØªØ­Ø§Ù† Ø®Ø§Ø±Ø¬ÙŠ
                                const examUrl = document.getElementById('examUrl').value.trim();
                                
                                if (!examUrl) {
                                    showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†', 'error');
                                    return false;
                                }
                                
                                const newExam = {
                                    title,
                                    duration: parseInt(duration),
                                    description,
                                    examType: 'external',
                                    examUrl,
                                    createdAt: new Date().toISOString()
                                };
                                
                                return addDoc(collection(db, 'exams'), newExam)
                                    .then((docRef) => {
                                        newExam.id = docRef.id;
                                        exams.push(newExam);
                                        renderExams();
                                        updateStats();
                                        showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                                        return true;
                                    })
                                    .catch((error) => {
                                        console.error('Failed to save exam:', error);
                                        showToast('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†: ' + error.message, 'error');
                                        return false;
                                    });
                                    
                            } else {
                                // Ø§Ù…ØªØ­Ø§Ù† Ù…Ø¯Ù…Ø¬
                                const questionElements = document.querySelectorAll('.question-item');
                                
                                if (questionElements.length === 0) {
                                    showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
                                    return false;
                                }
                                
                                const questions = [];
                                let hasError = false;
                                
                                questionElements.forEach((qEl) => {
                                    const qId = qEl.dataset.questionId;
                                    const questionText = document.getElementById(`question_${qId}_text`).value.trim();
                                    const type = document.getElementById(`question_${qId}_type`).value;
                                    const correctAnswer = parseInt(document.getElementById(`question_${qId}_correct`).value);
                                    const explanation = document.getElementById(`question_${qId}_explanation`).value.trim();
                                    
                                    if (!questionText) {
                                        showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ù†Øµ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©', 'error');
                                        hasError = true;
                                        return;
                                    }
                                    
                                    const optionsCount = type === 'true-false' ? 2 : 4;
                                    const options = [];
                                    
                                    for (let i = 0; i < optionsCount; i++) {
                                        const optionEl = document.getElementById(`question_${qId}_option_${i}`);
                                        if (optionEl) {
                                            const optionValue = optionEl.value.trim();
                                            if (!optionValue && type !== 'true-false') {
                                                showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª', 'error');
                                                hasError = true;
                                                return;
                                            }
                                            options.push(optionValue);
                                        }
                                    }
                                    
                                    questions.push({
                                        question: questionText,
                                        type: type,
                                        options: options,
                                        correctAnswer: correctAnswer,
                                        explanation: explanation
                                    });
                                });
                                
                                if (hasError) return false;
                                
                                const newExam = {
                                    title,
                                    duration: parseInt(duration),
                                    description,
                                    examType: 'internal',
                                    questions: questions,
                                    createdAt: new Date().toISOString()
                                };
                                
                                return addDoc(collection(db, 'exams'), newExam)
                                    .then((docRef) => {
                                        newExam.id = docRef.id;
                                        exams.push(newExam);
                                        renderExams();
                                        updateStats();
                                        showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ù…Ø¯Ù…Ø¬ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                                        console.log('Exam added with', questions.length, 'questions');
                                        return true;
                                    })
                                    .catch((error) => {
                                        console.error('Failed to save exam:', error);
                                        showToast('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†: ' + error.message, 'error');
                                        return false;
                                    });
                            }
                        }
                    );
                    
                    // Setup event listeners after modal is created
                    setTimeout(() => {
                        // Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
                        const examTypeSelect = document.getElementById('examType');
                        if (examTypeSelect) {
                            examTypeSelect.addEventListener('change', function() {
                                const isInternal = this.value === 'internal';
                                document.getElementById('externalExamGroup').style.display = isInternal ? 'none' : 'block';
                                document.getElementById('internalExamGroup').style.display = isInternal ? 'block' : 'none';
                                
                                // ØªØ­Ø¯ÙŠØ« required
                                document.getElementById('examUrl').required = !isInternal;
                            });
                        }
                        
                        // Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯
                        const addQuestionBtn = document.getElementById('addQuestionBtn');
                        if (addQuestionBtn) {
                            addQuestionBtn.addEventListener('click', function() {
                                questionCount++;
                                const questionHTML = `
                                    <div class="question-item" data-question-id="${questionCount}" style="background: rgba(15, 23, 42, 0.5); padding: 1.5rem; border-radius: 12px; margin-bottom: 1rem; border: 2px solid rgba(59, 130, 246, 0.2);">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                            <h4 style="color: #3b82f6; margin: 0;">Ø§Ù„Ø³Ø¤Ø§Ù„ ${questionCount}</h4>
                                            <button type="button" class="btn btn-sm btn-danger" onclick="removeQuestion(${questionCount})">ğŸ—‘ï¸</button>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label class="form-label">Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„</label>
                                            <textarea class="form-textarea" id="question_${questionCount}_text" rows="2" required></textarea>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„</label>
                                            <select class="form-select" id="question_${questionCount}_type" onchange="updateQuestionOptions(${questionCount})">
                                                <option value="true-false">ØµØ­ Ø£Ù… Ø®Ø·Ø£</option>
                                                <option value="mcq">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯</option>
                                            </select>
                                        </div>
                                        
                                        <div id="question_${questionCount}_options"></div>
                                        
                                        <div class="form-group">
                                            <label class="form-label">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</label>
                                            <select class="form-select" id="question_${questionCount}_correct" required></select>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label class="form-label">Ø§Ù„Ø´Ø±Ø­ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                                            <textarea class="form-textarea" id="question_${questionCount}_explanation" rows="2" placeholder="Ø´Ø±Ø­ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©"></textarea>
                                        </div>
                                    </div>
                                `;
                                
                                document.getElementById('questionsContainer').insertAdjacentHTML('beforeend', questionHTML);
                                updateQuestionOptions(questionCount);
                            });
                        }
                    }, 100);
                });
            } else {
                console.error('Add Exam Button not found!');
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø³Ø¤Ø§Ù„
            window.updateQuestionOptions = function(questionId) {
                const type = document.getElementById(`question_${questionId}_type`).value;
                const optionsContainer = document.getElementById(`question_${questionId}_options`);
                const correctSelect = document.getElementById(`question_${questionId}_correct`);
                
                if (type === 'true-false') {
                    optionsContainer.innerHTML = `
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª</label>
                            <input type="text" class="form-input" id="question_${questionId}_option_0" value="ØµØ­" readonly style="background: rgba(30, 41, 59, 0.5);">
                            <input type="text" class="form-input" id="question_${questionId}_option_1" value="Ø®Ø·Ø£" readonly style="margin-top: 0.5rem; background: rgba(30, 41, 59, 0.5);">
                        </div>
                    `;
                    correctSelect.innerHTML = `
                        <option value="0">ØµØ­</option>
                        <option value="1">Ø®Ø·Ø£</option>
                    `;
                } else {
                    optionsContainer.innerHTML = `
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª</label>
                            <input type="text" class="form-input" id="question_${questionId}_option_0" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„" required>
                            <input type="text" class="form-input" id="question_${questionId}_option_1" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ" required style="margin-top: 0.5rem;">
                            <input type="text" class="form-input" id="question_${questionId}_option_2" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù„Ø«" required style="margin-top: 0.5rem;">
                            <input type="text" class="form-input" id="question_${questionId}_option_3" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø±Ø§Ø¨Ø¹" required style="margin-top: 0.5rem;">
                        </div>
                    `;
                    correctSelect.innerHTML = `
                        <option value="0">Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„</option>
                        <option value="1">Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
                        <option value="2">Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù„Ø«</option>
                        <option value="3">Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø±Ø§Ø¨Ø¹</option>
                    `;
                }
            };
            
            // Ø­Ø°Ù Ø³Ø¤Ø§Ù„
            window.removeQuestion = function(questionId) {
                const questionEl = document.querySelector(`[data-question-id="${questionId}"]`);
                if (questionEl) {
                    questionEl.remove();
                }
            };



            // Add Note Button
            const addNoteBtn = document.getElementById('addNoteBtn');
            if (addNoteBtn) {
                console.log('Add Note Button found');
                addNoteBtn.addEventListener('click', function() {
                    console.log('Add Note button clicked');
                    createModal(
                        'Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©',
                        `
                        <form id="noteForm">
                            <div class="form-group">
                                <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</label>
                                <input type="text" class="form-input" id="noteTitle" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§Ù„Ù…Ø­ØªÙˆÙ‰</label>
                                <textarea class="form-textarea" id="noteContent" rows="6" required></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§Ù„ÙØ¦Ø©</label>
                                <select class="form-select" id="noteCategory">
                                    <option value="general">Ø¹Ø§Ù…</option>
                                    <option value="important">Ù…Ù‡Ù…</option>
                                    <option value="exam">Ù…ØªØ¹Ù„Ù‚ Ø¨Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</option>
                                </select>
                            </div>
                        </form>
                        `,
                        () => {
                            console.log('Processing note form...');
                            const title = document.getElementById('noteTitle').value.trim();
                            const content = document.getElementById('noteContent').value.trim();
                            const category = document.getElementById('noteCategory').value;
                            
                            console.log('ğŸ“‹ Form data:', { title, content, category });
                            
                            if (!title || !content) {
                                showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                                return false;
                            }
                            
                            const newNote = {
                                title,
                                content,
                                category,
                                createdAt: new Date().toISOString()
                            };
                            
                            console.log('Adding note to Firebase:', newNote);
                            
                            // Save to Firebase
                            return addDoc(collection(db, 'notes'), newNote)
                                .then((docRef) => {
                                    newNote.id = docRef.id;
                                    notes.push(newNote);
                                    renderNotes();
                                    updateStats();
                                    showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                                    console.log('Note added successfully to Firebase');
                                    return true;
                                })
                                .catch((error) => {
                                    console.error('Failed to save note to Firebase:', error);
                                    showToast('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©: ' + error.message, 'error');
                                    return false;
                                });
                        }
                    );
                });
            } else {
                console.error('Add Note Button not found!');
            }



            // Add Material Button
            const addMaterialBtn = document.getElementById('addMaterialBtn');
            if (addMaterialBtn) {
                console.log('Add Material Button found');
                addMaterialBtn.addEventListener('click', function() {
                    console.log('Add Material button clicked');
                    createModal(
                        'Ø¥Ø¶Ø§ÙØ© Ù…Ø°ÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©',
                        `
                        <form id="materialForm">
                            <div class="form-group">
                                <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø°ÙƒØ±Ø©</label>
                                <input type="text" class="form-input" id="materialTitle" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label>
                                <select class="form-select" id="materialGrade" required>
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>
                                    <option value="1">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                                    <option value="2">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                                    <option value="3">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ù…ØµØ¯Ø± Ø§Ù„Ù…Ø°ÙƒØ±Ø©</label>
                                <select class="form-select" id="materialSource" required>
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ØµØ¯Ø±</option>
                                    <option value="upload">Ø±ÙØ¹ Ù…Ù„Ù PDF</option>
                                    <option value="drive">Ø±Ø§Ø¨Ø· Google Drive</option>
                                    <option value="external">Ø±Ø§Ø¨Ø· Ø®Ø§Ø±Ø¬ÙŠ</option>
                                </select>
                            </div>
                            <div class="form-group" id="uploadMaterialGroup" style="display: none;">
                                <label class="form-label">Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„Ù…Ø°ÙƒØ±Ø© (PDF)</label>
                                <input type="file" class="form-input" id="materialFile" accept=".pdf">
                                <p style="color: #94a3b8; font-size: 0.875rem; margin-top: 0.5rem;">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: 10 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª</p>
                            </div>
                            <div class="form-group" id="linkMaterialGroup" style="display: none;">
                                <label class="form-label">Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø°ÙƒØ±Ø©</label>
                                <input type="url" class="form-input" id="materialUrl" placeholder="https://drive.google.com/...">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§Ù„ÙˆØµÙ</label>
                                <textarea class="form-textarea" id="materialDescription"></textarea>
                            </div>
                        </form>
                        `,
                        (closeModal) => {
                            console.log('Processing material form...');
                            const title = document.getElementById('materialTitle').value.trim();
                            const grade = document.getElementById('materialGrade').value;
                            const source = document.getElementById('materialSource').value;
                            const description = document.getElementById('materialDescription').value.trim();
                            const fileInput = document.getElementById('materialFile');
                            const urlInput = document.getElementById('materialUrl');
                            
                            console.log('ğŸ“‹ Form data:', { title, grade, source, description });
                            
                            if (!title || !grade || !source) {
                                showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                                return false;
                            }
                            
                            let materialUrl = '';
                            let fileName = '';
                            let fileSize = '';
                            
                            if (source === 'upload') {
                                if (!fileInput.files || !fileInput.files[0]) {
                                    showToast('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ù…Ø°ÙƒØ±Ø©', 'error');
                                    return false;
                                }
                                
                                const file = fileInput.files[0];
                                if (file.size > 10 * 1024 * 1024) {
                                    showToast('Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 10 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª)', 'error');
                                    return false;
                                }
                                
                                return new Promise((resolve) => {
                                    const reader = new FileReader();
                                    reader.onload = function(e) {
                                        const newMaterial = {
                                            title,
                                            grade,
                                            source,
                                            description,
                                            fileUrl: e.target.result,
                                            fileName: file.name,
                                            fileSize: (file.size / (1024 * 1024)).toFixed(2) + ' MB',
                                            createdAt: new Date().toISOString()
                                        };
                                        
                                        // Save to Firebase
                                        addDoc(collection(db, 'materials'), newMaterial)
                                            .then((docRef) => {
                                                newMaterial.id = docRef.id;
                                                materials.push(newMaterial);
                                                renderMaterials();
                                                showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø°ÙƒØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                                                resolve(true);
                                            })
                                            .catch((error) => {
                                                console.error('Failed to save material to Firebase:', error);
                                                showToast('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ø°ÙƒØ±Ø©: ' + error.message, 'error');
                                                resolve(false);
                                            });
                                    };
                                    reader.readAsDataURL(file);
                                });
                            } else {
                                if (!urlInput.value.trim()) {
                                    showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø°ÙƒØ±Ø©', 'error');
                                    return false;
                                }
                                
                                materialUrl = urlInput.value.trim();
                                fileName = 'Ø±Ø§Ø¨Ø· Ø®Ø§Ø±Ø¬ÙŠ';
                                fileSize = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                                
                                const newMaterial = {
                                    title,
                                    grade,
                                    source,
                                    description,
                                    fileUrl: materialUrl,
                                    fileName,
                                    fileSize,
                                    createdAt: new Date().toISOString()
                                };
                                
                                // Save to Firebase
                                return addDoc(collection(db, 'materials'), newMaterial)
                                    .then((docRef) => {
                                        newMaterial.id = docRef.id;
                                        materials.push(newMaterial);
                                        renderMaterials();
                                        showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø°ÙƒØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                                        return true;
                                    })
                                    .catch((error) => {
                                        console.error('Failed to save material to Firebase:', error);
                                        showToast('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ø°ÙƒØ±Ø©: ' + error.message, 'error');
                                        return false;
                                    });
                            }
                        }
                    );
                });
            } else {
                console.error('Add Material Button not found!');
            }

            // Materials Tabs
            const materialsTabs = document.querySelectorAll('.tab-btn');
            materialsTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    materialsTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    const grade = this.getAttribute('data-grade');
                    document.querySelectorAll('.materials-content').forEach(content => {
                        content.classList.remove('active');
                        content.style.display = 'none';
                    });
                    const targetContent = document.getElementById(`materialsGrade${grade}`);
                    if (targetContent) {
                        targetContent.classList.add('active');
                        targetContent.style.display = 'block';
                    }
                });
            });



            function renderNotes() {
                console.log('Rendering notes...');
                const notesList = document.getElementById('notesList');
                if (!notesList) {
                    console.error('Notes list element not found!');
                    return;
                }
                
                if (notes.length === 0) {
                    notesList.innerHTML = '<p style="text-align: center; color: #94a3b8; padding: 2rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
                    return;
                }
                
                const categoryLabels = {
                 'general': 'Ø¹Ø§Ù…',
                    'important': 'Ù…Ù‡Ù…',
                    'exam': 'Ù…ØªØ¹Ù„Ù‚ Ø¨Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†'
                };
                
                notesList.innerHTML = notes.map(note => `
                    <div class="content-item">
                        <div class="content-item-header">
                            <h3 class="content-item-title">${note.title}</h3>
                            <div class="content-item-actions">
                                <button class="btn btn-sm btn-danger" onclick="deleteNote('${note.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                            </div>
                        </div>
                        <p style="color: #94a3b8; margin-top: 0.5rem;">${note.content}</p>
                        <p style="color: #64748b; font-size: 0.875rem; margin-top: 0.5rem;">Ø§Ù„ÙØ¦Ø©: ${categoryLabels[note.category]}</p>
                    </div>
                `).join('');
                
                console.log('Notes rendered:', notes.length);
            }



            function renderMaterials() {
                console.log('Rendering materials...');
                const gradeLabels = {
                    '1': 'Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ',
                    '2': 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ',
                    '3': 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ'
                };
                
                ['1', '2', '3'].forEach(grade => {
                    const container = document.getElementById(`materialsGrade${grade}`);
                    if (!container) {
                        console.error(`Materials container for grade ${grade} not found!`);
                        return;
                    }
                    
                    const gradeMaterials = materials.filter(m => m.grade === grade);
                    
                    if (gradeMaterials.length === 0) {
                        container.innerHTML = `<p style="text-align: center; color: #94a3b8; padding: 2rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø°ÙƒØ±Ø§Øª Ù„Ù€ ${gradeLabels[grade]}</p>`;
                        return;
                    }
                    
                    container.innerHTML = gradeMaterials.map(material => `
                        <div class="content-item">
                            <div class="content-item-header">
                                <h3 class="content-item-title">ğŸ“š ${material.title}</h3>
                                <div class="content-item-actions">
                                    <button class="btn btn-sm btn-primary" onclick="window.open('${material.fileUrl}', '_blank')">ğŸ“„ Ø¹Ø±Ø¶</button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteMaterial('${material.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                                </div>
                            </div>
                            <p style="color: #94a3b8; margin-top: 0.5rem;">${material.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}</p>
                            <p style="color: #64748b; font-size: 0.875rem; margin-top: 0.5rem;">
                                Ø§Ù„ØµÙ: ${gradeLabels[material.grade]} | Ø§Ù„Ø­Ø¬Ù…: ${material.fileSize}
                            </p>
                        </div>
                    `).join('');
                });
                
                console.log('Materials rendered for all grades');
            }

            function renderVideos() {
                console.log('Rendering videos...');
                const videosList = document.getElementById('videosList');
                if (!videosList) {
                    console.error('Videos list element not found!');
                    return;
                }
                
                if (videos.length === 0) {
                    videosList.innerHTML = '<p style="text-align: center; color: #94a3b8; padding: 2rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
                    return;
                }
                
                videosList.innerHTML = videos.map(video => `
                    <div class="content-item">
                        <div class="content-item-header">
                            <h3 class="content-item-title">ğŸ¥ ${video.title}</h3>
                            <div class="content-item-actions">
                                <button class="btn btn-sm btn-primary" onclick="window.open('${video.videoUrl}', '_blank')">â–¶ï¸ Ø¹Ø±Ø¶</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteVideo('${video.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                            </div>
                        </div>
                        ${video.notes ? `<p style="color: #94a3b8; margin-top: 0.5rem;">${video.notes}</p>` : ''}
                        <p style="color: #64748b; font-size: 0.875rem; margin-top: 0.5rem;">Ø§Ù„Ù…Ø¯Ø©: ${video.duration || 0} Ø¯Ù‚ÙŠÙ‚Ø©</p>
                    </div>
                `).join('');
                
                console.log('Videos rendered:', videos.length);
            }

            function renderExams() {
                console.log('Rendering exams...');
                const examsList = document.getElementById('examsList');
                if (!examsList) {
                    console.error('Exams list element not found!');
                    return;
                }
                
                if (exams.length === 0) {
                    examsList.innerHTML = '<p style="text-align: center; color: #94a3b8; padding: 2rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
                    return;
                }
                
                examsList.innerHTML = exams.map(exam => {
                    const examTypeLabel = exam.examType === 'internal' ? 'ğŸ“ Ø§Ù…ØªØ­Ø§Ù† Ù…Ø¯Ù…Ø¬' : 'ğŸ”— Ø§Ù…ØªØ­Ø§Ù† Ø®Ø§Ø±Ø¬ÙŠ';
                    const examTypeColor = exam.examType === 'internal' ? '#10b981' : '#3b82f6';
                    
                    let actionButton = '';
                    if (exam.examType === 'internal') {
                        actionButton = `<button class="btn btn-sm btn-primary" onclick="window.location.href='exam-player.html?id=${exam.id}'">ğŸ“ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</button>`;
                    } else {
                        actionButton = `<button class="btn btn-sm btn-primary" onclick="window.open('${exam.examUrl}', '_blank')">ğŸ“ ÙØªØ­ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</button>`;
                    }
                    
                    return `
                        <div class="content-item">
                            <div class="content-item-header">
                                <div>
                                    <h3 class="content-item-title">ğŸ“‹ ${exam.title}</h3>
                                    <p style="color: ${examTypeColor}; font-size: 0.875rem; margin-top: 0.25rem;">${examTypeLabel}${exam.examType === 'internal' ? ` (${exam.questions?.length || 0} Ø³Ø¤Ø§Ù„)` : ''}</p>
                                </div>
                                <div class="content-item-actions">
                                    ${actionButton}
                                    <button class="btn btn-sm btn-danger" onclick="deleteExam('${exam.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                                </div>
                            </div>
                            ${exam.description ? `<p style="color: #94a3b8; margin-top: 0.5rem;">${exam.description}</p>` : ''}
                            <p style="color: #64748b; font-size: 0.875rem; margin-top: 0.5rem;">Ø§Ù„Ù…Ø¯Ø©: ${exam.duration || 0} Ø¯Ù‚ÙŠÙ‚Ø©</p>
                        </div>
                    `;
                }).join('');
                
                console.log('Exams rendered:', exams.length);
                
                // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª ÙÙŠ Ø§Ù„ÙÙ„ØªØ±
                const examFilter = document.getElementById('examFilter');
                if (examFilter) {
                    examFilter.innerHTML = '<option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</option>' +
                        exams.map(exam => `<option value="${exam.id}">${exam.title}</option>`).join('');
                }
            }
            
            function renderStudentResults(filterExamId = 'all') {
                console.log('Rendering student results...');
                const resultsList = document.getElementById('studentResultsList');
                if (!resultsList) {
                    console.error('Results list element not found!');
                    return;
                }
                
                let filteredResults = examResults;
                if (filterExamId !== 'all') {
                    filteredResults = examResults.filter(r => r.examId === filterExamId);
                }
                
                if (filteredResults.length === 0) {
                    resultsList.innerHTML = '<p style="text-align: center; color: #94a3b8; padding: 2rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
                    return;
                }
                
                // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® (Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹)
                filteredResults.sort((a, b) => new Date(b.completedAt) - new Date(a.completedAt));
                
                resultsList.innerHTML = filteredResults.map(result => {
                    const passed = result.passed;
                    const date = new Date(result.completedAt).toLocaleString('ar-EG');
                    const percentage = Math.round(result.score);
                    
                    return `
                        <div class="content-item">
                            <div class="content-item-header">
                                <div>
                                    <h3 class="content-item-title">ğŸ‘¤ ${result.userEmail}</h3>
                                    <p style="color: #94a3b8; font-size: 0.875rem; margin-top: 0.25rem;">ğŸ“‹ ${result.examTitle}</p>
                                </div>
                                <div style="text-align: left;">
                                    <div style="font-size: 2rem; font-weight: bold; color: ${passed ? '#10b981' : '#f87171'};">
                                        ${percentage}%
                                    </div>
                                    <div style="color: #64748b; font-size: 0.875rem;">
                                        ${result.correctAnswers}/${result.totalQuestions}
                                    </div>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem;">
                                <span style="color: #94a3b8; font-size: 0.875rem;">ğŸ“… ${date}</span>
                                <span style="padding: 0.5rem 1rem; border-radius: 8px; font-size: 0.875rem; font-weight: bold; background: ${passed ? 'rgba(16, 185, 129, 0.2)' : 'rgba(239, 68, 68, 0.2)'}; color: ${passed ? '#10b981' : '#f87171'};">
                                    ${passed ? 'âœ… Ù†Ø§Ø¬Ø­' : 'âŒ Ø±Ø§Ø³Ø¨'}
                                </span>
                            </div>
                        </div>
                    `;
                }).join('');
                
                console.log('Results rendered:', filteredResults.length);
            }
            
            // Event listener Ù„Ù„ÙÙ„ØªØ±
            const examFilter = document.getElementById('examFilter');
            if (examFilter) {
                examFilter.addEventListener('change', function() {
                    renderStudentResults(this.value);
                });
            }

            function updateStats() {
                console.log('Updating stats...');
                document.getElementById('totalVideos').textContent = videos.length;
                document.getElementById('totalExams').textContent = exams.length;
                document.getElementById('totalNotes').textContent = notes.length;
                document.getElementById('totalStudents').textContent = '0'; // ÙŠÙ…ÙƒÙ† ØªØ­Ø¯ÙŠØ«Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹
                console.log('Stats updated');
            }

            // Delete Functions
            window.deleteVideo = function(id) {
                console.log('Deleting video from Firebase:', id);
                createConfirmModal(
                    'Ø­Ø°Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ',
                    'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙÙŠØ¯ÙŠÙˆØŸ',
                    () => {
                        deleteDoc(doc(db, 'videos', id))
                            .then(() => {
                                videos = videos.filter(v => v.id !== id);
                                renderVideos();
                                updateStats();
                                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                                console.log('Video deleted from Firebase');
                            })
                            .catch((error) => {
                                console.error('Error deleting video:', error);
                                showToast('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ: ' + error.message, 'error');
                            });
                    }
                );
            };

            window.deleteExam = function(id) {
                console.log('Deleting exam from Firebase:', id);
                createConfirmModal(
                    'Ø­Ø°Ù Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†',
                    'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†ØŸ',
                    () => {
                        deleteDoc(doc(db, 'exams', id))
                            .then(() => {
                                exams = exams.filter(e => e.id !== id);
                                renderExams();
                                updateStats();
                                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                                console.log('Exam deleted from Firebase');
                            })
                            .catch((error) => {
                                console.error('Error deleting exam:', error);
                                showToast('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†: ' + error.message, 'error');
                            });
                    }
                );
            };



            window.deleteNote = function(id) {
                console.log('Deleting note from Firebase:', id);
                createConfirmModal(
                    'Ø­Ø°Ù Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©',
                    'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©ØŸ',
                    () => {
                        deleteDoc(doc(db, 'notes', id))
                            .then(() => {
                                notes = notes.filter(n => n.id !== id);
                                renderNotes();
                                updateStats();
                                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                                console.log('Note deleted from Firebase');
                            })
                            .catch((error) => {
                                console.error('Error deleting note:', error);
                                showToast('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©: ' + error.message, 'error');
                            });
                    }
                );
            };



            window.deleteMaterial = function(id) {
                console.log('Deleting material from Firebase:', id);
                createConfirmModal(
                    'Ø­Ø°Ù Ø§Ù„Ù…Ø°ÙƒØ±Ø©',
                    'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø°ÙƒØ±Ø©ØŸ',
                    () => {
                        deleteDoc(doc(db, 'materials', id))
                            .then(() => {
                                materials = materials.filter(m => m.id !== id);
                                renderMaterials();
                                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø°ÙƒØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                                console.log('Material deleted from Firebase');
                            })
                            .catch((error) => {
                                console.error('Error deleting material:', error);
                                showToast('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ø°ÙƒØ±Ø©: ' + error.message, 'error');
                            });
                    }
                );
            };

            // Initial render
            console.log('Initial rendering...');
            renderVideos();
            renderExams();
            renderNotes();
            renderMaterials();
            renderStudentResults();
            updateStats();
            
            // Test buttons after a short delay
            setTimeout(() => {
                const noteBtn = document.getElementById('addNoteBtn');
                const materialBtn = document.getElementById('addMaterialBtn');
                
                console.log('Button status check:', {
                    noteBtn: !!noteBtn,
                    materialBtn: !!materialBtn
                });
                
                if (!noteBtn) console.error('Note button missing!');
                if (!materialBtn) console.error('Material button missing!');
            }, 1000);
            
            // ========================================
            // MOTIVATIONAL MESSAGES MANAGEMENT
            // ========================================
            
            let motivationalMessages = [];
            
            // Load motivational messages
            async function loadMotivationalMessages() {
                try {
                    const db = window.firebaseDb;
                    const collection = window.firebaseCollection;
                    const getDocs = window.firebaseGetDocs;
                    
                    if (!db || !collection || !getDocs) {
                        throw new Error('Firebase not initialized');
                    }
                    
                    const snapshot = await getDocs(collection(db, 'motivationalMessages'));
                    motivationalMessages = [];
                    
                    snapshot.forEach(doc => {
                        motivationalMessages.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    // Save to localStorage for student pages
                    localStorage.setItem('motivationalMessages', JSON.stringify(motivationalMessages));
                    
                    renderMotivationalMessages();
                    console.log('âœ… Loaded motivational messages:', motivationalMessages.length);
                } catch (error) {
                    console.error('âŒ Error loading motivational messages:', error);
                    showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªØ­ÙÙŠØ²ÙŠØ©', 'error');
                }
            }
            
            // Render motivational messages
            function renderMotivationalMessages() {
                const container = document.getElementById('motivationalList');
                if (!container) return;
                
                if (motivationalMessages.length === 0) {
                    container.innerHTML = `
                        <div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: #94a3b8;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ’¬</div>
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ ØªØ­ÙÙŠØ²ÙŠØ© Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                            <p style="font-size: 0.9rem; margin-top: 0.5rem;">Ø§Ø¶ØºØ· "Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø©" Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = motivationalMessages.map(msg => `
                    <div class="content-card" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(168, 85, 247, 0.1)); border-color: rgba(139, 92, 246, 0.3);">
                        <div class="card-header">
                            <h3 style="color: #a78bfa;">ğŸ’¬ Ø±Ø³Ø§Ù„Ø© ØªØ­ÙÙŠØ²ÙŠØ©</h3>
                            <button class="btn-icon delete-btn" onclick="deleteMotivationalMessage('${msg.id}')" title="Ø­Ø°Ù">
                                ğŸ—‘ï¸
                            </button>
                        </div>
                        <div class="card-body">
                            <p style="color: #e9d5ff; font-size: 1.1rem; line-height: 1.8; margin: 1rem 0;">${msg.message}</p>
                            <div class="card-meta">
                                <span>ğŸ“… ${new Date(msg.createdAt).toLocaleDateString('ar-EG')}</span>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            // Add motivational message button
            const addMotivationalBtn = document.getElementById('addMotivationalBtn');
            if (addMotivationalBtn) {
                addMotivationalBtn.addEventListener('click', () => {
                    const modal = document.createElement('div');
                    modal.className = 'modal active';
                    modal.innerHTML = `
                        <div class="modal-overlay"></div>
                        <div class="modal-content">
                            <div class="modal-header">
                                <h2>ğŸ’¬ Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ØªØ­ÙÙŠØ²ÙŠØ©</h2>
                                <button class="modal-close">Ã—</button>
                            </div>
                            <form id="addMotivationalForm">
                                <div class="form-group">
                                    <label>Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­ÙÙŠØ²ÙŠØ© *</label>
                                    <textarea id="motivationalMessage" required rows="4" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ© ÙˆÙ…Ø­ÙØ²Ø© Ù„Ù„Ø·Ù„Ø§Ø¨..."></textarea>
                                </div>
                                <div class="info-box" style="margin-bottom: 1rem;">
                                    <p>ğŸ’¡ Ù†ØµØ§Ø¦Ø­ Ù„ÙƒØªØ§Ø¨Ø© Ø±Ø³Ø§Ù„Ø© ØªØ­ÙÙŠØ²ÙŠØ© ÙØ¹Ø§Ù„Ø©:</p>
                                    <ul style="margin: 0.5rem 0 0 1.5rem;">
                                        <li>Ø§Ø³ØªØ®Ø¯Ù… Ù„ØºØ© Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ© ÙˆÙ…Ø´Ø¬Ø¹Ø©</li>
                                        <li>Ø§Ø¬Ø¹Ù„Ù‡Ø§ Ù‚ØµÙŠØ±Ø© ÙˆÙ…Ø¨Ø§Ø´Ø±Ø©</li>
                                        <li>Ø±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„ØªØ­ÙÙŠØ² ÙˆØ§Ù„Ø¥Ù„Ù‡Ø§Ù…</li>
                                    </ul>
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-primary">âœ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø³Ø§Ù„Ø©</button>
                                    <button type="button" class="btn btn-secondary close-modal">âŒ Ø¥Ù„ØºØ§Ø¡</button>
                                </div>
                            </form>
                        </div>
                    `;
                    
                    document.body.appendChild(modal);
                    
                    const form = modal.querySelector('#addMotivationalForm');
                    const closeBtn = modal.querySelector('.modal-close');
                    const cancelBtn = modal.querySelector('.close-modal');
                    const overlay = modal.querySelector('.modal-overlay');
                    
                    const closeModal = () => modal.remove();
                    
                    form.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        
                        const message = document.getElementById('motivationalMessage').value.trim();
                        
                        if (!message) {
                            showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©', 'error');
                            return;
                        }
                        
                        try {
                            const db = window.firebaseDb;
                            const collection = window.firebaseCollection;
                            const addDoc = window.firebaseAddDoc;
                            
                            if (!db || !collection || !addDoc) {
                                throw new Error('Firebase not initialized');
                            }
                            
                            const newMessage = {
                                message: message,
                                createdAt: new Date().toISOString(),
                                active: true
                            };
                            
                            await addDoc(collection(db, 'motivationalMessages'), newMessage);
                            
                            showToast('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­ÙÙŠØ²ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                            closeModal();
                            await loadMotivationalMessages();
                        } catch (error) {
                            console.error('âŒ Error adding motivational message:', error);
                            showToast('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø³Ø§Ù„Ø©: ' + error.message, 'error');
                        }
                    });
                    
                    closeBtn.addEventListener('click', closeModal);
                    cancelBtn.addEventListener('click', closeModal);
                    overlay.addEventListener('click', closeModal);
                    
                    setTimeout(() => {
                        document.getElementById('motivationalMessage').focus();
                    }, 100);
                });
            }
            
            // Delete motivational message
            window.deleteMotivationalMessage = async function(messageId) {
                if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­ÙÙŠØ²ÙŠØ©ØŸ')) {
                    return;
                }
                
                try {
                    const db = window.firebaseDb;
                    const doc = window.firebaseDoc;
                    const deleteDoc = window.firebaseDeleteDoc;
                    
                    if (!db || !doc || !deleteDoc) {
                        throw new Error('Firebase not initialized');
                    }
                    
                    await deleteDoc(doc(db, 'motivationalMessages', messageId));
                    
                    showToast('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­ÙÙŠØ²ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    await loadMotivationalMessages();
                } catch (error) {
                    console.error('âŒ Error deleting motivational message:', error);
                    showToast('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©: ' + error.message, 'error');
                }
            };
            
            console.log('Dashboard initialization complete!');
        });
    </script>
    
    <!-- Mobile Menu Script -->
    <script src="../assets/js/mobile-menu.js"></script>
</body>
</html>